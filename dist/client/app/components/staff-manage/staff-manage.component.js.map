{"version":3,"sources":["../../client/app/components/staff-manage/staff-manage.component.ts"],"names":[],"mappings":"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","file":"staff-manage.component.js","sourcesContent":["import { Component, OnInit } from '@angular/core';\r\nimport { StaffService } from \"../../services/staff.service\";\r\nimport { StudentService } from \"../../services/student.service\";\r\nimport { User } from \"../../models/user\";\r\nimport { Router } from '@angular/router';\r\ndeclare var swal: any;\r\n\r\n\r\n@Component({\r\n    selector: 'staff-manage',\r\n    templateUrl: './app/components/staff-manage/staff-manage.component.html',\r\n    styleUrls: ['./app/components/staff-manage/staff-manage.component.css']\r\n})\r\n\r\n\r\nexport class StaffManageComponent implements OnInit {\r\n    users: User[];\r\n    usersBackup: User[];\r\n    error: any;\r\n    usersLength: any;\r\n    adminNumber: any;\r\n    staffNumber: any;\r\n    instructorNumber: any;\r\n\r\n    constructor(private router: Router, private staffService: StaffService, private studentService: StudentService) {\r\n\r\n    }\r\n\r\n    ngOnInit() {\r\n      swal({\r\n        title: 'Loading...',\r\n        allowOutsideClick: false\r\n      });\r\n      swal.showLoading();\r\n      this.getUsers();\r\n    }\r\n\r\n    getUsers() {\r\n        this.staffService\r\n          .getUsers()\r\n          .then(users => {\r\n            if ((users as any).result === \"error\") {\r\n              this.users = null;\r\n              this.displayErrorAlert((users as any));\r\n            } else {\r\n              this.users = users;\r\n              for (let user of this.users) {\r\n                user.fullName = user.firstName + \" \" + user.lastName;\r\n              }\r\n              this.usersBackup = this.users;\r\n              this.usersLength = users.length;\r\n              this.updateStats();\r\n            }\r\n          })\r\n          .catch(error => this.error = error);\r\n    }\r\n\r\n    runAttendanceCheck() {\r\n        this.studentService\r\n          .manualAttendanceCheck()\r\n          .then(result => {\r\n            if ((result as any).result === \"error\") {\r\n              this.displayErrorAlert((result as any));\r\n            } else {\r\n              swal(\r\n                  result.title,\r\n                  result.msg,\r\n                  'success'\r\n              );\r\n            }\r\n          })\r\n          .catch(error => this.error = error);\r\n    }\r\n\r\n    gotoEdit(user: User, event: any) {\r\n        this.router.navigate(['/staff-details', user.userID]);\r\n    }\r\n\r\n    addUser() {\r\n        this.router.navigate(['/staff-details', 'new']);\r\n    }\r\n\r\n    deleteAlert(user: User, event: any) {\r\n        swal({\r\n            title: 'Delete ' + user.firstName + ' ' + user.lastName + '?',\r\n            text: \"You won't be able to revert this!\",\r\n            type: 'warning',\r\n            showCancelButton: true,\r\n            confirmButtonColor: '#3085d6',\r\n            cancelButtonColor: '#d33',\r\n            confirmButtonText: 'Yes, delete!'\r\n        }).then(isConfirm => {\r\n          if (isConfirm.dismiss === \"cancel\" || isConfirm.dismiss === \"overlay\") {\r\n            console.log(isConfirm.dismiss);\r\n          } else if (isConfirm) {\r\n            this.deleteUser(user, event);\r\n          }\r\n        }).catch(error => {\r\n          console.log(error);\r\n        });\r\n    }\r\n\r\n    deleteUser(user: User, event: any) {\r\n        event.stopPropagation();\r\n        this.staffService\r\n          .delete(user)\r\n          .then(res => {\r\n            console.log(res);\r\n            if ((res as any).result === \"error\") {\r\n              this.displayErrorAlert((res as any));\r\n            } else if ((res as any).result === \"success\") {\r\n              this.users = this.users.filter(h => h !== user);\r\n              this.usersBackup = this.users;\r\n              this.usersLength = this.users.length;\r\n              this.updateStats();\r\n              swal(\r\n                  'Deleted!',\r\n                  'User has been deleted.',\r\n                  'success'\r\n              );\r\n            } else {\r\n              swal(\r\n                  'Error',\r\n                  'Something went wrong, please try again.',\r\n                  'error'\r\n              );\r\n            }\r\n          })\r\n          .catch(error => this.error = error);\r\n    }\r\n\r\n    updateStats() {\r\n      this.adminNumber = this.users.filter(x => x.userType.indexOf(\"Admin\") !== -1);\r\n      this.adminNumber = this.adminNumber.length;\r\n      this.staffNumber = this.users.filter(x => x.userType.indexOf(\"Staff\") !== -1);\r\n      this.staffNumber = this.staffNumber.length;\r\n      this.instructorNumber = this.users.filter(x => x.userType.indexOf(\"Instructor\") !== -1);\r\n      this.instructorNumber = this.instructorNumber.length;\r\n      swal.close();\r\n    }\r\n\r\n    filterStaff(userType) {\r\n      this.users = this.usersBackup;\r\n      if (userType === 'total') {\r\n        this.users = this.usersBackup;\r\n      } else {\r\n        this.users = this.users.filter(x => x.userType.indexOf(userType) !== -1);\r\n      }\r\n    }\r\n\r\n    displayErrorAlert(error) {\r\n      if (error.title === \"Auth Error\") {\r\n        this.router.navigate(['/login']);\r\n        swal(\r\n          error.title,\r\n          error.msg,\r\n          'info'\r\n        );\r\n      } else {\r\n        swal(\r\n          error.title,\r\n          error.msg,\r\n          'error'\r\n        );\r\n      }\r\n    }\r\n\r\n    goBack() {\r\n        window.history.back();\r\n    }\r\n}\r\n"]}