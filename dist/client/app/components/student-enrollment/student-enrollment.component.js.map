{"version":3,"sources":["../../client/app/components/student-enrollment/student-enrollment.component.ts"],"names":[],"mappings":"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","file":"student-enrollment.component.js","sourcesContent":["import { Component, Input, OnInit } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { ActivatedRoute, Params } from '@angular/router';\r\nimport { Course } from \"../../models/course\";\r\nimport { Student } from \"../../models/Student\";\r\nimport { CourseService } from \"../../services/course.service\";\r\nimport { StudentService } from \"../../services/student.service\";\r\ndeclare var swal: any;\r\ndeclare var moment: any;\r\n\r\n@Component({\r\n  selector: 'course-selection',\r\n  templateUrl: './app/components/student-enrollment/student-enrollment.component.html',\r\n  styleUrls: ['./app/components/student-enrollment/student-enrollment.component.css']\r\n})\r\n\r\nexport class StudentEnrollmentComponent implements OnInit {\r\n  students: Student[];\r\n  courseID: any;\r\n  instructorID: any;\r\n  courseName: any;\r\n  studentTimetables: any[];\r\n  loading: boolean = true;\r\n  tempTimetableArry: any[] = [];\r\n\r\n  constructor(private studentService: StudentService, private courseService: CourseService, private route: ActivatedRoute) {\r\n\r\n  }\r\n\r\n  ngOnInit() {\r\n    this.route.params.forEach((params: Params) => {\r\n      this.courseID = params['courseID'];\r\n      this.instructorID = params['instructorID'];\r\n      this.courseName = params['courseName'];\r\n    });\r\n    this.getStudents();\r\n  }\r\n\r\n  getStudents() {\r\n    this.studentService\r\n      .getStudents()\r\n      .then(result => {\r\n        if ((result as any).result === 'error') {\r\n          this.students = null;\r\n          this.displayErrorAlert(result);\r\n        } else {\r\n          this.students = result;\r\n          for (let student of this.students) {\r\n            student.fullName = student.firstName + \" \" + student.lastName;\r\n          }\r\n          this.getTimetables();\r\n        }\r\n      }).catch(error => error);\r\n  }\r\n\r\n  getTimetables() {\r\n    this.studentService\r\n      .getTimetables()\r\n      .then(result => {\r\n        if ((result as any).result === 'error') {\r\n          this.displayErrorAlert(result);\r\n        } else {\r\n          this.studentTimetables = result;\r\n          this.compareTimetables();\r\n        }\r\n      })\r\n      .catch(error => error);\r\n  }\r\n\r\n  compareTimetables() {\r\n    for (let student of this.students) {\r\n      var timetable = this.studentTimetables.filter(x => x.userID === student.userID);\r\n      for (let item of timetable) {\r\n        var itemCourseID = item.courseID.toString();\r\n        if (itemCourseID === this.courseID) {\r\n          student.enrolled = true;\r\n        }\r\n      }\r\n    }\r\n    this.loading = false;\r\n  }\r\n\r\n  checkEnrolled(student: Student) {\r\n    if (student.enrolled) {\r\n      swal({\r\n        title: 'Remove ' + student.firstName + ' ' + student.lastName + ' from ' + this.courseName + '?',\r\n        text: \"\",\r\n        type: 'warning',\r\n        showCancelButton: true,\r\n        confirmButtonColor: '#3085d6',\r\n        cancelButtonColor: '#d33',\r\n        confirmButtonText: 'Yes, remove!'\r\n      }).then(isConfirm => {\r\n        if (isConfirm.dismiss === \"cancel\" || isConfirm.dismiss === \"overlay\") {\r\n          console.log(isConfirm.dismiss);\r\n        } else if (isConfirm) {\r\n          this.drop(student);\r\n        }\r\n      }).catch(error => {\r\n        console.log(error);\r\n      });\r\n    } else {\r\n      this.enroll(student);\r\n    }\r\n  }\r\n\r\n  enroll(student: Student) {\r\n    var startDate = moment(student.studentStartDate, \"DDD MMM YYYY h:mm:ss LT\").isValid();\r\n    var endDate = moment(student.studentEndDate, \"DDD MMM YYYY h:mm:ss LT\").isValid();\r\n    if (startDate && endDate) {\r\n      this.studentService\r\n        .courseEnroll(student.userID, student.studentStartDate, student.studentEndDate, this.courseID, this.instructorID)\r\n        .then(result => {\r\n          if ((result as any).result === 'error') {\r\n            this.displayErrorAlert(result);\r\n          } else if ((result as any).result === 'success') {\r\n            student.enrolled = true;\r\n            swal(\r\n              this.courseName,\r\n              '' + student.firstName + ' ' + student.lastName + ' has been succesfully enrolled.',\r\n              'success'\r\n            );\r\n          } else {\r\n            swal(\r\n              'Error',\r\n              'Something went wrong while enrolling student.',\r\n              'error'\r\n            );\r\n          }\r\n        })\r\n        .catch(error => error);\r\n    } else {\r\n      swal(\r\n        'Whoops',\r\n        'Please input a valid start and end date for the student.',\r\n        'warning'\r\n      );\r\n    }\r\n  }\r\n\r\n  drop(student: Student) {\r\n    this.studentService\r\n      .courseDrop(student.userID, this.courseID)\r\n      .then(result => {\r\n        if ((result as any).result === 'error') {\r\n          this.displayErrorAlert(result);\r\n        } else if ((result as any).result === 'success') {\r\n          student.enrolled = false;\r\n        } else {\r\n          swal(\r\n            'Error',\r\n            'Something went wrong, please try again.',\r\n            'error'\r\n          );\r\n        }\r\n      })\r\n      .catch(error => error);\r\n  }\r\n\r\n  displayErrorAlert(error) {\r\n    swal(\r\n      error.title,\r\n      error.msg,\r\n      'error'\r\n    );\r\n  }\r\n\r\n  goBack() {\r\n    window.history.back();\r\n  }\r\n}\r\n"]}