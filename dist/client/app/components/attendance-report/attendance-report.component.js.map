{"version":3,"sources":["../../client/app/components/attendance-report/attendance-report.component.ts"],"names":[],"mappings":"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","file":"attendance-report.component.js","sourcesContent":["import { Component, OnInit } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { StudentService } from \"../../services/student.service\";\r\nimport { Student } from \"../../models/student\";\r\nimport { CourseService } from \"../../services/course.service\";\r\nimport { Course } from \"../../models/course\";\r\ndeclare var moment: any;\r\n\r\n@Component({\r\n    selector: 'attendanceReportComponet',\r\n    templateUrl: './app/components/attendance-report/attendance-report.component.html',\r\n    styleUrls: ['./app/components/attendance-report/attendance-report.component.css']\r\n})\r\n\r\nexport class AttendanceReportComponent implements OnInit {\r\n    data: any;\r\n    courses: Course[];\r\n    students: Student[];\r\n    totalAbsences: any;\r\n\r\n    studentAttendanceView: boolean = false;\r\n    student: any[];\r\n    attendance: any[];\r\n    records = [];\r\n    totalPresent: any;\r\n    totalAbsent: any;\r\n    totalMadeContact: any;\r\n    noAttendance: boolean = false;\r\n\r\n    studentReport: boolean = false;\r\n\r\n    timetables: any[];\r\n\r\n    courseAttendanceView: boolean = false;\r\n    course: any;\r\n    classTimeStr: any;\r\n    courseData: any[];\r\n    courseStudents: any[];\r\n    courseTimetables: any[];\r\n    studentRecord: any[];\r\n    noStudentsEnrolled: boolean = false;\r\n\r\n    classAbsenceTotal: any;\r\n    classPresenceTotal: any;\r\n    classMadeContactTotal: any;\r\n\r\n    constructor(private router: Router, private studentService: StudentService, private courseService: CourseService) {\r\n\r\n    }\r\n\r\n    ngOnInit() {\r\n        this.studentService\r\n            .getAllAttendance()\r\n            .then(attendance => {\r\n                if (attendance.status === \"403\") {\r\n                    this.data = null;\r\n                } else {\r\n                    this.data = attendance;\r\n                    this.getStudents();\r\n                }\r\n            })\r\n            .catch(error => console.log(error));\r\n    }\r\n\r\n    getStudents() {\r\n        this.studentService\r\n            .getStudents()\r\n            .then(students => {\r\n                if ((students as any).status === \"403\") {\r\n                    this.students = null;\r\n                } else {\r\n                    this.students = students;\r\n                    for (let student of this.students) {\r\n                        student.fullName = student.firstName + \" \" + student.lastName;\r\n                    }\r\n                }\r\n                this.getCourses();\r\n            })\r\n            .catch(error => console.log(error));\r\n    }\r\n\r\n    getCourses() {\r\n        this.courseService\r\n            .getCourses()\r\n            .then(result => {\r\n                if ((result as any).status === \"403\") {\r\n                    this.courses = null;\r\n                } else {\r\n                    //format datetime\r\n                    result.forEach((item) => {\r\n                        item.courseStart = moment(item.courseStart).format('YYYY-MM-DD');\r\n                        item.courseEnd = moment(item.courseEnd).format('YYYY-MM-DD');\r\n                        // item.classStartTime = moment(item.classStartTime).format('hh:mm A');\r\n                        // item.classEndTime = moment(item.classEndTime).format('hh:mm A');\r\n                    });\r\n                    this.courses = result;\r\n                    this.getTimetables();\r\n                }\r\n\r\n            })\r\n            .catch(error => console.log(error));\r\n    }\r\n\r\n    getTimetables() {\r\n        this.studentService\r\n            .getTimetables()\r\n            .then(result => {\r\n                if (result.status === \"403\") {\r\n                    this.timetables = null;\r\n                } else {\r\n                    this.timetables = result;\r\n                }\r\n            })\r\n            .catch(error => console.log(error));\r\n    }\r\n\r\n    viewStudentReport(student: Student) {\r\n        this.records = [];\r\n        this.studentAttendanceView = true;\r\n        this.attendance = this.data.filter(x => x.userID === student.userID);\r\n        this.student = this.students.filter(x => x.studentID === student.studentID);\r\n        this.student = this.student[0];\r\n        this.totalPresent = this.attendance.filter(x => x.attendanceValue === 'P').length;\r\n        this.totalAbsent = this.attendance.filter(x => x.attendanceValue === 'A').length;\r\n        this.totalMadeContact = this.attendance.filter(x => x.attendanceValue === 'MC').length;\r\n\r\n        if (this.attendance.length === 0) {\r\n            this.noAttendance = true;\r\n        } else {\r\n            this.noAttendance = false;\r\n            for (let item of this.attendance) {\r\n                var course = this.courses.filter(x => x.courseID === item.courseID);\r\n                var attendance = {\r\n                    course: course,\r\n                    date: item.date,\r\n                    attendanceValue: item.attendanceValue\r\n                };\r\n                this.records.push(attendance);\r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    viewCourseReport(course: Course) {\r\n        this.courseTimetables = [];\r\n        this.courseStudents = [];\r\n        this.courseAttendanceView = true;\r\n        this.course = course;\r\n        this.classTimeStr = this.course.classTimeStr;\r\n\r\n        this.classAbsenceTotal = this.data.filter(x => x.courseID === course.courseID && x.attendanceValue === 'A').length;\r\n        this.classPresenceTotal = this.data.filter(x => x.courseID === course.courseID && x.attendanceValue === 'P').length;\r\n        this.classMadeContactTotal = this.data.filter(x => x.courseID === course.courseID && x.attendanceValue === 'MC').length;\r\n\r\n        if (this.classTimeStr) {\r\n          var array = this.classTimeStr.split(',');\r\n          this.classTimeStr = [];\r\n          for (let item of array) {\r\n            var date = item.split(' ');\r\n            // var day = date[0];\r\n            // var time = date[1];\r\n            // var startTime = time.split('-')[0];\r\n            // var endTime = time.split('-')[1];\r\n            this.classTimeStr.push(date);\r\n          }\r\n        }\r\n\r\n        var studentInfo;\r\n\r\n        if (this.data.length === 0) {\r\n            this.noAttendance = true;\r\n        } else {\r\n            this.noAttendance = false;\r\n            this.courseTimetables = this.timetables.filter(x => x.courseID === course.courseID);\r\n            for (let item of this.courseTimetables) {\r\n                studentInfo = {\r\n                    student: this.students.filter(x => x.userID === item.userID)[0],\r\n                    startDate: item.startDate,\r\n                    endDate: item.endDate,\r\n                    attendanceInfo: this.data.filter(x => x.userID === item.userID && x.courseID === course.courseID)\r\n                };\r\n                this.courseStudents.push(studentInfo);\r\n            }\r\n        }\r\n\r\n        if (this.courseStudents.length === 0) {\r\n          this.noStudentsEnrolled = true;\r\n        } else {\r\n          this.noStudentsEnrolled = false;\r\n        }\r\n    }\r\n\r\n    overallStatus() {\r\n        this.courseAttendanceView = false;\r\n        this.studentAttendanceView = false;\r\n        this.noAttendance = false;\r\n    }\r\n\r\n    goBack() {\r\n        window.history.back();\r\n    }\r\n}\r\n"]}