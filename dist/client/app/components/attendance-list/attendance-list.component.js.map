{"version":3,"sources":["../../client/app/components/attendance-list/attendance-list.component.ts"],"names":[],"mappings":"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","file":"attendance-list.component.js","sourcesContent":["import { Component, OnInit } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { CourseService } from \"../../services/course.service\";\r\nimport { Course } from \"../../models/course\";\r\nimport { Student } from \"../../models/Student\";\r\nimport { StudentService } from \"../../services/student.service\";\r\nimport { StaffService } from \"../../services/staff.service\";\r\ndeclare var swal: any;\r\ndeclare var moment;\r\n\r\n@Component({\r\n  selector: 'attendanceList',\r\n  templateUrl: './app/components/attendance-list/attendance-list.component.html',\r\n  styleUrls: ['./app/components/attendance-list/attendance-list.component.css']\r\n})\r\n\r\nexport class AttendanceListComponent implements OnInit {\r\n  data: any;\r\n  date: any;\r\n  courseID: any;\r\n  attendanceView: boolean = false;\r\n  loading: boolean = false;\r\n  attendanceCourse: any;\r\n  attendanceStudents: any;\r\n  timetables: any;\r\n  attendance: any;\r\n  absentStudents = [];\r\n  attendanceDates: any[] = [];\r\n  previousAttendance: any;\r\n  instructors: any;\r\n  instructorOptions: any = {};\r\n  selectedInstructor: number;\r\n\r\n  constructor(private router: Router, private CourseService: CourseService, private StudentService: StudentService, private StaffService: StaffService) {\r\n    this.date = new Date();\r\n  }\r\n\r\n  ngOnInit() {\r\n    swal({\r\n      title: 'Loading...',\r\n      allowOutsideClick: false\r\n    });\r\n    swal.showLoading();\r\n    var currentUser = JSON.parse(localStorage.getItem('currentUser'));\r\n    var userID = currentUser.userID;\r\n    if (currentUser.userType !== 'Instructor') {\r\n      this.StaffService\r\n        .getUsers()\r\n        .then(instructors => {\r\n          if ((instructors as any).result === 'error') {\r\n            this.displayErrorAlert(instructors);\r\n          } else {\r\n            this.instructors = instructors.filter(x => x.userType.indexOf(\"Instructor\") !== -1);\r\n            swal.close();\r\n          }\r\n        })\r\n        .catch(error => {\r\n          // do something\r\n        });\r\n    } else {\r\n      this.getCourses(userID);\r\n      this.StudentService\r\n        .getAllAttendance()\r\n        .then(attendance => {\r\n          if ((attendance as any).result === 'error') {\r\n            this.displayErrorAlert(attendance);\r\n            this.previousAttendance = null;\r\n          } else {\r\n            this.previousAttendance = attendance;\r\n            for (let item of this.previousAttendance) {\r\n              item.date = item.date[0] + \" \" + item.date[1];\r\n            }\r\n          }\r\n        })\r\n        .catch(error => console.log(error));\r\n      swal.close();\r\n    }\r\n  }\r\n\r\n  instructorSelect() {\r\n    this.attendanceDates = [];\r\n    this.attendanceView = null;\r\n    swal({\r\n      title: 'Loading...',\r\n      allowOutsideClick: false\r\n    });\r\n    swal.showLoading();\r\n    this.getCourses(this.selectedInstructor);\r\n    this.StudentService\r\n      .getAllAttendance()\r\n      .then(attendance => {\r\n        if ((attendance as any).result === 'error') {\r\n          this.previousAttendance = null;\r\n          this.displayErrorAlert(attendance);\r\n        } else {\r\n          this.previousAttendance = attendance;\r\n          for (let item of this.previousAttendance) {\r\n            item.date = item.date[0] + \" \" + item.date[1];\r\n          }\r\n        }\r\n        swal.close();\r\n      })\r\n      .catch(error => console.log(error));\r\n  }\r\n\r\n  getCourses(instructorID) {\r\n    this.CourseService\r\n      .getInstructorCourses(instructorID)\r\n      .then(result => {\r\n        var isEmpty = (result || []).length === 0;\r\n        if ((result as any).result === 'error') {\r\n          this.data = null;\r\n          this.displayErrorAlert(result);\r\n        } else if (isEmpty) {\r\n          this.data = null;\r\n          swal(\r\n            'No Courses',\r\n            'No courses attached to this instructor id.',\r\n            'warning'\r\n          );\r\n        } else {\r\n          this.data = result;\r\n        }\r\n      })\r\n      .catch(error => console.log(error));\r\n  }\r\n\r\n  doAttendance(course: Course) {\r\n    this.attendanceDates = [];\r\n    swal({\r\n      title: 'Loading...',\r\n      allowOutsideClick: false\r\n    });\r\n    swal.showLoading();\r\n    this.previousAttendance = this.previousAttendance.filter(x => x.courseID === course.courseID);\r\n    this.courseID = course.courseID;\r\n    this.StudentService\r\n      .getTimetablesByCourseId(course.courseID)\r\n      .then(result => {\r\n        var isEmpty = (result || []).length === 0;\r\n        if ((result as any).result === 'error') {\r\n          this.timetables = null;\r\n          this.attendanceStudents = null;\r\n          this.displayErrorAlert(result);\r\n        } else if (isEmpty) {\r\n          this.timetables = null;\r\n          this.attendanceStudents = null;\r\n          swal(\r\n            'No Students',\r\n            'No students attached to this course id.',\r\n            'warning'\r\n          );\r\n        } else {\r\n          this.timetables = result;\r\n          this.getStudentsById(this.timetables);\r\n        }\r\n      })\r\n      .catch(error => console.log(error));\r\n\r\n    this.attendanceCourse = course;\r\n    var array = this.attendanceCourse.classTimeStr.split(',');\r\n    for (let item of array) {\r\n      var attendanceHistory = this.previousAttendance;\r\n      attendanceHistory = attendanceHistory.filter(x => x.date === item);\r\n      if (attendanceHistory.length !== 0) {\r\n        console.log(\"Attendance already taken\");\r\n      } else {\r\n        var date = item.split(' ');\r\n        var formattedDate = moment(date[0]).format(\"ddd, MMM Do YYYY\");\r\n        var list = {\r\n          label: formattedDate + ' from ' + date[1],\r\n          value: date[0] + ' ' + date[1]\r\n        };\r\n        this.attendanceDates.push(list);\r\n      }\r\n    }\r\n    this.attendanceView = true;\r\n  }\r\n\r\n  getStudentsById(timetables) {\r\n    console.log(timetables);\r\n    this.StudentService\r\n      .getStudentsById(timetables)\r\n      .then(result => {\r\n        var isEmpty = (result || []).length === 0;\r\n        if ((result as any).result === 'error') {\r\n          this.attendanceStudents = null;\r\n          this.displayErrorAlert(result);\r\n        } else if (isEmpty) {\r\n          this.attendanceStudents = null;\r\n          swal(\r\n            'No Students',\r\n            'No students attached to this course id.',\r\n            'warning'\r\n          );\r\n        } else {\r\n          this.attendanceStudents = result;\r\n          for (let student of this.attendanceStudents) {\r\n            student.fullName = student.firstName + \" \" + student.lastName;\r\n          }\r\n          swal.close();\r\n        }\r\n      })\r\n      .catch(error => console.log(error));\r\n  }\r\n\r\n  submitAttendance() {\r\n    var count = 0;\r\n    for (let student of this.attendanceStudents) {\r\n      if (student.attendanceValue) {\r\n        count++;\r\n      }\r\n    }\r\n\r\n    if (!this.attendanceCourse.attendanceDate) {\r\n      console.log(this.attendanceCourse);\r\n      swal(\r\n        'Attendance Incomplete',\r\n        'Please enter an attendance date',\r\n        'warning'\r\n      );\r\n    } else if (count === this.attendanceStudents.length && this.attendanceCourse.attendanceDate) {\r\n      swal({\r\n        title: 'Submit Attendance?',\r\n        text: \"You won't be able to revert this!\",\r\n        type: 'info',\r\n        showCancelButton: true,\r\n        confirmButtonColor: '#3085d6',\r\n        cancelButtonColor: '#d33',\r\n        confirmButtonText: 'Yes, submit!'\r\n      }).then(isConfirm => {\r\n        if (isConfirm.dismiss === \"cancel\" || isConfirm.dismiss === \"overlay\") {\r\n          console.log(isConfirm.dismiss);\r\n        } else if (isConfirm) {\r\n          this.attendance = {\r\n            students: this.attendanceStudents,\r\n            courseID: this.courseID,\r\n            date: this.attendanceCourse.attendanceDate\r\n          };\r\n          this.StudentService\r\n            .insertAttendance(this.attendance)\r\n            .then(result => {\r\n              if ((result as any).result === 'error') {\r\n                this.displayErrorAlert(result);\r\n              } else if ((result as any).result === 'success') {\r\n                swal(\r\n                  'Attendance submitted!',\r\n                  '',\r\n                  'success'\r\n                );\r\n                this.attendanceView = false;\r\n                this.router.navigate(['/attendance-report']);\r\n              } else {\r\n                swal(\r\n                  'Error',\r\n                  'Something went wrong, please try again.',\r\n                  'error'\r\n                );\r\n              }\r\n            })\r\n            .catch(error => console.log(error));\r\n        }\r\n      }).catch(error => {\r\n        console.log(error);\r\n      });\r\n    } else {\r\n      swal(\r\n        'Attendance Incomplete',\r\n        'Please enter attendance for all students',\r\n        'warning'\r\n      );\r\n    }\r\n\r\n  }\r\n\r\n  displayErrorAlert(error) {\r\n    swal(\r\n      error.title,\r\n      error.msg,\r\n      'error'\r\n    );\r\n  }\r\n\r\n  goBack() {\r\n    window.history.back();\r\n  }\r\n}\r\n"]}