"use strict";
const schedule = require('node-schedule');
const MailService = require("./MailService");
const ActivityService = require("./ActivityService");
var sql = require('mssql');
var config = require('../config');
var executeType = "Manual";
//runs every night at 7:30pm
var timer = schedule.scheduleJob('0 36 16 * * *', function () {
    executeType = "Automatic";
    this.attendanceCheck();
});
class ScheduleService {
    attendanceCheck() {
        try {
            var date = new Date();
            var twoMissedClasses = 0, fourMissedClasses = 0;
            var student;
            sql.connect(config.db)
                .then(function (connection) {
                new sql.Request(connection)
                    .query("SELECT * FROM Attendance ORDER BY date DESC")
                    .then(function (attendanceResult) {
                    new sql.Request(connection)
                        .query("SELECT userID, firstName, lastName FROM Students")
                        .then(function (studentsResult) {
                        new sql.Request(connection)
                            .query("SELECT userID, email FROM Users")
                            .then(function (usersResult) {
                            new sql.Request(connection)
                                .query("SELECT courseID, courseName FROM Course")
                                .then(function (coursesResult) {
                                for (let student of studentsResult) {
                                    var userInfo = usersResult.filter(x => x.userID === student.userID);
                                    var studentAttendance = attendanceResult.filter(x => x.userID === student.userID);
                                    console.log("# of attendance records for " + student.firstName + ": " + studentAttendance.length);
                                    function courseBy(array, f) {
                                        var courses = {};
                                        array.forEach(function (o) {
                                            var course = JSON.stringify(f(o));
                                            courses[course] = courses[course] || [];
                                            courses[course].push(o);
                                        });
                                        return Object.keys(courses).map(function (course) {
                                            return courses[course];
                                        });
                                    }
                                    var result = courseBy(studentAttendance, function (item) {
                                        return [item.courseID, item.userID];
                                    });
                                    for (let course of result) {
                                        for (var i = 0; i < course.length - 1; i++) {
                                            var availableCourses = course.filter(x => x.fourMissedClassMsg === false);
                                            if (availableCourses.length >= 4 && course[i + 1] != null && course[i + 2] != null && course[i + 3] != null) {
                                                if (course[i].fourMissedClassMsg === false &&
                                                    course[i + 1].fourMissedClassMsg === false &&
                                                    course[i + 2].fourMissedClassMsg === false &&
                                                    course[i + 3].fourMissedClassMsg === false &&
                                                    course[i].attendanceValue === 'A' &&
                                                    course[i + 1].attendanceValue === 'A' &&
                                                    course[i + 2].attendanceValue === 'A' &&
                                                    course[i + 3].attendanceValue === 'A') {
                                                    //mark attendance records as reviewed and message sent
                                                    course[i].fourMissedClassMsg = true;
                                                    course[i + 1].fourMissedClassMsg = true;
                                                    course[i + 2].fourMissedClassMsg = true;
                                                    course[i + 3].fourMissedClassMsg = true;
                                                    course[i].twoMissedClassMsg = true;
                                                    course[i + 1].twoMissedClassMsg = true;
                                                    course[i + 2].twoMissedClassMsg = true;
                                                    course[i + 3].twoMissedClassMsg = true;
                                                    var courseInfo = coursesResult.filter(x => x.courseID === course[i].courseID);
                                                    console.log("__________________________________________________________________________________________");
                                                    console.log("Four consecutive classes missed by: " + student.firstName + " " + student.lastName);
                                                    console.log("Student ID: " + course[i].userID + " - " + course[i + 1].userID);
                                                    console.log("Dates: " + course[i].date + ' & ' + course[i + 1].date + ' & ' + course[i + 2].date + ' & ' + course[i + 3].date);
                                                    console.log("Course ID: " + course[i].courseID + " - " + course[i + 1].courseID);
                                                    console.log("Email: " + userInfo[0].email);
                                                    console.log("__________________________________________________________________________________________");
                                                    fourMissedClasses += 1;
                                                    let mailOptions = {
                                                        from: config.mail.user,
                                                        to: userInfo[0].email,
                                                        subject: 'Removal from ' + courseInfo[0].courseName,
                                                        text: '',
                                                        html: 'Hi ' + student.firstName + ',<br /><br />Our records indicate that you have missed 50% or more of your ' + courseInfo[0].courseName +
                                                            ' classes in the last four weeks. Our policy states that students will be withdrawn when this much time has been missed. Unfortunately, ' +
                                                            'this means that you are being exited from ' + courseInfo[0].courseName + ' class.<br /><br />Please contact me by phone at 705-728-1968, Ext. XXXX or by ' +
                                                            'email at <a>Cheryl.Boyes@GeorgianCollege.ca</a> to complete the necessary paperwork and discuss possible opportunities for returning to the ' +
                                                            courseInfo[0].courseName + ' class at a later date.<br /><br />Regards,<br /><br /><strong>Cheryl Boyes</strong><br /><strong>Academic Upgrading Officer</strong>' +
                                                            '<br />Georgian College| One Georgian Drive | Barrie ON | L4M 3X9' // html body
                                                    };
                                                    var query = "UPDATE Attendance SET fourMissedClassMsg = 'true', twoMissedClassMsg = 'true' WHERE attendanceID IN" +
                                                        " ('" + course[i].attendanceID + "','" + course[i + 1].attendanceID + "','" + course[i + 2].attendanceID + "','" + course[i + 3].attendanceID + "')";
                                                    new sql.Request(connection)
                                                        .query(query)
                                                        .then(function (result) {
                                                        new sql.Request(connection)
                                                            .query("UPDATE Students SET status = 4 WHERE userID = " + student.userID)
                                                            .then(function (result) {
                                                            new MailService().sendMessage('Four Missed Classes', mailOptions);
                                                            new ActivityService().reportActivity('scheduledEmails', 'Four Missed Classes', 'success', student.userID, '', student.firstName + ' ' + student.lastName + ' has missed four consecutive classes for the following course: ' + courseInfo[0].courseName);
                                                        }).catch(function (err) {
                                                            console.log("ScheduleService - Update student status: " + err);
                                                        });
                                                    }).catch(function (err) {
                                                        console.log("ScheduleService - Update attendance records: " + err);
                                                    });
                                                }
                                            }
                                            if (course.length >= 2 && course[i + 1] != null) {
                                                if (course[i].attendanceValue === 'A' &&
                                                    course[i + 1].attendanceValue === 'A' &&
                                                    course[i].twoMissedClassMsg === false &&
                                                    course[i + 1].twoMissedClassMsg === false) {
                                                    //mark attendance records as reviewed and message sent
                                                    course[i].twoMissedClassMsg = true;
                                                    course[i + 1].twoMissedClassMsg = true;
                                                    var courseInfo = coursesResult.filter(x => x.courseID === course[i].courseID);
                                                    console.log("__________________________________________________________________________________________");
                                                    console.log("Two consecutive classes have been missed by: " + student.firstName + " " + student.lastName);
                                                    console.log("Student ID: " + student.userID);
                                                    console.log("Dates: " + course[i].date + ' & ' + course[i + 1].date);
                                                    console.log("Course ID: " + course[i].courseID + " - " + course[i + 1].courseID);
                                                    console.log("Email: " + userInfo[0].email);
                                                    console.log("__________________________________________________________________________________________");
                                                    twoMissedClasses += 1;
                                                    let mailOptions = {
                                                        from: config.mail.user,
                                                        to: userInfo[0].email,
                                                        subject: 'Two Missed ' + courseInfo[0].courseName + ' Classes',
                                                        text: '',
                                                        html: 'Hi ' + student.firstName + ',<br /><br />I noticed that you missed the last two consecutive ' + courseInfo[0].courseName + ' classes.' +
                                                            ' I hope everything is okay. Let me know if there is something I can do to help.<br /><br />Please be reminded of our program ' +
                                                            'policy that states students are responsible to notify their instructors when they will be absent. In addition, the policy directs ' +
                                                            'students to arrange for a leave of absence if they need to miss two or more classes in a row. A leave of absence can be arranged with ' +
                                                            'Cheryl Boyes, who can contacted by phone at 705-728-1968, Ext. XXXX or by email at <a>Cheryl.Boyes@GeorgianCollege.ca</a><br /><br />Please ' +
                                                            'get in touch with me as soon as possible. Unfortunately, if I don’t hear from you, and you miss the next two classes, you risk being withdrawn ' +
                                                            'from ' + courseInfo[0].courseName + '.<br /><br />Best Regards,<br /><br /><strong>Joanne Pineda, MA AdEd</strong><br /><strong>Academic Preparation Faculty' +
                                                            '</strong><br /><br />Georgian College| One Georgian Drive | Barrie ON | L4M 3X9' // html body
                                                    };
                                                    var query = "UPDATE Attendance SET twoMissedClassMsg = 'true' WHERE attendanceID IN ('" + course[i].attendanceID + "','" + course[i + 1].attendanceID + "')";
                                                    new sql.Request(connection)
                                                        .query(query)
                                                        .then(function (result) {
                                                        new sql.Request(connection)
                                                            .query("UPDATE Students SET status = 2 WHERE userID = " + student.userID)
                                                            .then(function (result) {
                                                            new MailService().sendMessage('Two Missed Classes', mailOptions);
                                                            new ActivityService().reportActivity('scheduledEmails', 'Two Missed Classes', 'success', student.userID, '', student.firstName + ' ' + student.lastName + ' has missed two consecutive classes for the following course: ' + courseInfo[0].courseName);
                                                        }).catch(function (err) {
                                                            console.log("ScheduleService - Update student status: " + err);
                                                        });
                                                    }).catch(function (err) {
                                                        console.log("ScheduleService - Update attendance: " + err);
                                                    });
                                                }
                                            }
                                        }
                                    }
                                }
                                let mailOptionsAdmin = {
                                    from: 'academic.career.prep@gmail.com',
                                    to: 'academic.career.prep@gmail.com',
                                    subject: 'SCHEDULER ✔',
                                    text: '',
                                    html: '<b> Hi admin!</b><br  /><br  />There were <strong>' + twoMissedClasses + '</strong> emails sent out due to missed classes today. <br/> There were <strong>' +
                                        fourMissedClasses + '</strong> removals from a course today.' // html body
                                };
                                new MailService().sendMessage("Scheduled Message", mailOptionsAdmin);
                                new ActivityService().reportActivity('scheduledEmails', executeType + ' - Scheduled Attendance Check', 'success', '', '', student.firstName + ' ' + student.lastName + 'Scheduled check of student attendance has completed successfully!<br/>There were <strong>' + twoMissedClasses + '</strong> emails sent for missing two classes in a row.<br/>There were <strong>' + fourMissedClasses + '</strong> emails sent for missing four classes in a row.');
                                console.log("TOTAL WARNING EMAILS SENT: " + twoMissedClasses);
                                console.log("TOTAL REMOVAL EMAILS SENT: " + fourMissedClasses);
                            }).catch(function (err) {
                                console.log("Select courseID and courseName from all courses " + err);
                            });
                        }).catch(function (err) {
                            console.log("Select userID and email from all users " + err);
                        });
                    }).catch(function (err) {
                        console.log("Select all students " + err);
                    });
                }).catch(function (err) {
                    console.log("Select userID and email from all users " + err);
                });
            }).catch(function (err) {
                console.log(err);
            });
        }
        catch (err) {
            console.log(err);
        }
    }
}
module.exports = ScheduleService;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NlcnZlci9zcmMvc2VydmljZXMvU2NoZWR1bGVTZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxNQUFNLFFBQVEsR0FBRyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUM7QUFDMUMsTUFBTSxXQUFXLEdBQUcsT0FBTyxDQUFDLGVBQWUsQ0FBQyxDQUFDO0FBQzdDLE1BQU0sZUFBZSxHQUFHLE9BQU8sQ0FBQyxtQkFBbUIsQ0FBQyxDQUFDO0FBQ3JELElBQUksR0FBRyxHQUFHLE9BQU8sQ0FBQyxPQUFPLENBQUMsQ0FBQztBQUMzQixJQUFJLE1BQU0sR0FBRyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7QUFDbEMsSUFBSSxXQUFXLEdBQUcsUUFBUSxDQUFDO0FBRTNCLDRCQUE0QjtBQUM1QixJQUFJLEtBQUssR0FBRyxRQUFRLENBQUMsV0FBVyxDQUFDLGVBQWUsRUFBRTtJQUNoRCxXQUFXLEdBQUcsV0FBVyxDQUFDO0lBQzFCLElBQUksQ0FBQyxlQUFlLEVBQUUsQ0FBQztBQUN6QixDQUFDLENBQUMsQ0FBQztBQUVIO0lBQ0UsZUFBZTtRQUNiLElBQUk7WUFDRixJQUFJLElBQUksR0FBRyxJQUFJLElBQUksRUFBRSxDQUFDO1lBQ3RCLElBQUksZ0JBQWdCLEdBQUcsQ0FBQyxFQUFFLGlCQUFpQixHQUFHLENBQUMsQ0FBQztZQUNoRCxJQUFJLE9BQU8sQ0FBQztZQUNaLEdBQUcsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLEVBQUUsQ0FBQztpQkFDckIsSUFBSSxDQUFDLFVBQVMsVUFBVTtnQkFDdkIsSUFBSSxHQUFHLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQztxQkFDMUIsS0FBSyxDQUFDLDZDQUE2QyxDQUFDO3FCQUNwRCxJQUFJLENBQUMsVUFBUyxnQkFBZ0I7b0JBQzdCLElBQUksR0FBRyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUM7eUJBQzFCLEtBQUssQ0FBQyxrREFBa0QsQ0FBQzt5QkFDekQsSUFBSSxD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LENBQUM7d0JBQ0wsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLFVBQVMsR0FBRzs0QkFDbkIsT0FBTyxDQUFDLEdBQUcsQ0FBQyx5Q0FBeUMsR0FBRyxHQUFHLENBQUMsQ0FBQzt3QkFDL0QsQ0FBQyxDQUFDLENBQUM7b0JBQ0wsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLFVBQVMsR0FBRzt3QkFDbkIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxzQkFBc0IsR0FBRyxHQUFHLENBQUMsQ0FBQztvQkFDNUMsQ0FBQyxDQUFDLENBQUM7Z0JBQ0wsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLFVBQVMsR0FBRztvQkFDbkIsT0FBTyxDQUFDLEdBQUcsQ0FBQyx5Q0FBeUMsR0FBRyxHQUFHLENBQUMsQ0FBQztnQkFDL0QsQ0FBQyxDQUFDLENBQUM7WUFDTCxDQUFDLENBQUMsQ0FBQyxLQUFLLENBQUMsVUFBUyxHQUFHO2dCQUNuQixPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1lBQ25CLENBQUMsQ0FBQyxDQUFDO1NBQ0o7UUFDRCxPQUFPLEdBQUcsRUFBRTtZQUNWLE9BQU8sQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUM7U0FDbEI7SUFDSCxDQUFDO0NBQ0o7QUFDRCxpQkFBUyxlQUFlLENBQUMiLCJmaWxlIjoic2VydmljZXMvU2NoZWR1bGVTZXJ2aWNlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3Qgc2NoZWR1bGUgPSByZXF1aXJlKCdub2RlLXNjaGVkdWxlJyk7XHJcbmNvbnN0IE1haWxTZXJ2aWNlID0gcmVxdWlyZShcIi4vTWFpbFNlcnZpY2VcIik7XHJcbmNvbnN0IEFjdGl2aXR5U2VydmljZSA9IHJlcXVpcmUoXCIuL0FjdGl2aXR5U2VydmljZVwiKTtcclxudmFyIHNxbCA9IHJlcXVpcmUoJ21zc3FsJyk7XHJcbnZhciBjb25maWcgPSByZXF1aXJlKCcuLi9jb25maWcnKTtcclxudmFyIGV4ZWN1dGVUeXBlID0gXCJNYW51YWxcIjtcclxuXHJcbi8vcnVucyBldmVyeSBuaWdodCBhdCA3OjMwcG1cclxudmFyIHRpbWVyID0gc2NoZWR1bGUuc2NoZWR1bGVKb2IoJzAgMzYgMTYgKiAqIConLCBmdW5jdGlvbigpIHtcclxuICBleGVjdXRlVHlwZSA9IFwiQXV0b21hdGljXCI7XHJcbiAgdGhpcy5hdHRlbmRhbmNlQ2hlY2soKTtcclxufSk7XHJcblxyXG5jbGFzcyBTY2hlZHVsZVNlcnZpY2Uge1xyXG4gIGF0dGVuZGFuY2VDaGVjaygpIHtcclxuICAgIHRyeSB7XHJcbiAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoKTtcclxuICAgICAgdmFyIHR3b01pc3NlZENsYXNzZXMgPSAwLCBmb3VyTWlzc2VkQ2xhc3NlcyA9IDA7XHJcbiAgICAgIHZhciBzdHVkZW50O1xyXG4gICAgICBzcWwuY29ubmVjdChjb25maWcuZGIpXHJcbiAgICAgIC50aGVuKGZ1bmN0aW9uKGNvbm5lY3Rpb24pIHtcclxuICAgICAgICBuZXcgc3FsLlJlcXVlc3QoY29ubmVjdGlvbilcclxuICAgICAgICAucXVlcnkoXCJTRUxFQ1QgKiBGUk9NIEF0dGVuZGFuY2UgT1JERVIgQlkgZGF0ZSBERVNDXCIpXHJcbiAgICAgICAgLnRoZW4oZnVuY3Rpb24oYXR0ZW5kYW5jZVJlc3VsdCkge1xyXG4gICAgICAgICAgbmV3IHNxbC5SZXF1ZXN0KGNvbm5lY3Rpb24pXHJcbiAgICAgICAgICAucXVlcnkoXCJTRUxFQ1QgdXNlcklELCBmaXJzdE5hbWUsIGxhc3ROYW1lIEZST00gU3R1ZGVudHNcIilcclxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHN0dWRlbnRzUmVzdWx0KSB7XHJcbiAgICAgICAgICAgIG5ldyBzcWwuUmVxdWVzdChjb25uZWN0aW9uKVxyXG4gICAgICAgICAgICAucXVlcnkoXCJTRUxFQ1QgdXNlcklELCBlbWFpbCBGUk9NIFVzZXJzXCIpXHJcbiAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHVzZXJzUmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgbmV3IHNxbC5SZXF1ZXN0KGNvbm5lY3Rpb24pXHJcbiAgICAgICAgICAgICAgLnF1ZXJ5KFwiU0VMRUNUIGNvdXJzZUlELCBjb3Vyc2VOYW1lIEZST00gQ291cnNlXCIpXHJcbiAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24oY291cnNlc1Jlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgZm9yIChsZXQgc3R1ZGVudCBvZiBzdHVkZW50c1Jlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICB2YXIgdXNlckluZm8gPSB1c2Vyc1Jlc3VsdC5maWx0ZXIoeCA9PiB4LnVzZXJJRCA9PT0gc3R1ZGVudC51c2VySUQpO1xyXG4gICAgICAgICAgICAgICAgICB2YXIgc3R1ZGVudEF0dGVuZGFuY2UgPSBhdHRlbmRhbmNlUmVzdWx0LmZpbHRlcih4ID0+IHgudXNlcklEID09PSBzdHVkZW50LnVzZXJJRCk7XHJcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiIyBvZiBhdHRlbmRhbmNlIHJlY29yZHMgZm9yIFwiICsgc3R1ZGVudC5maXJzdE5hbWUgKyBcIjogXCIgKyBzdHVkZW50QXR0ZW5kYW5jZS5sZW5ndGgpO1xyXG4gICAgICAgICAgICAgICAgICBmdW5jdGlvbiBjb3Vyc2VCeShhcnJheSwgZikge1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjb3Vyc2VzID0ge307XHJcbiAgICAgICAgICAgICAgICAgICAgYXJyYXkuZm9yRWFjaChmdW5jdGlvbihvKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICB2YXIgY291cnNlID0gSlNPTi5zdHJpbmdpZnkoZihvKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICBjb3Vyc2VzW2NvdXJzZV0gPSBjb3Vyc2VzW2NvdXJzZV0gfHwgW107XHJcbiAgICAgICAgICAgICAgICAgICAgICBjb3Vyc2VzW2NvdXJzZV0ucHVzaChvKTtcclxuICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmtleXMoY291cnNlcykubWFwKGZ1bmN0aW9uKGNvdXJzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvdXJzZXNbY291cnNlXTtcclxuICAgICAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBjb3Vyc2VCeShzdHVkZW50QXR0ZW5kYW5jZSwgZnVuY3Rpb24oaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBbaXRlbS5jb3Vyc2VJRCwgaXRlbS51c2VySURdO1xyXG4gICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgZm9yIChsZXQgY291cnNlIG9mIHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY291cnNlLmxlbmd0aCAtIDE7IGkrKykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgdmFyIGF2YWlsYWJsZUNvdXJzZXMgPSBjb3Vyc2UuZmlsdGVyKHggPT4geC5mb3VyTWlzc2VkQ2xhc3NNc2cgPT09IGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgICAgIGlmIChhdmFpbGFibGVDb3Vyc2VzLmxlbmd0aCA+PSA0ICYmIGNvdXJzZVtpICsgMV0gIT0gbnVsbCAmJiBjb3Vyc2VbaSArIDJdICE9IG51bGwgJiYgY291cnNlW2kgKyAzXSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjb3Vyc2VbaV0uZm91ck1pc3NlZENsYXNzTXNnID09PSBmYWxzZSAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZVtpICsgMV0uZm91ck1pc3NlZENsYXNzTXNnID09PSBmYWxzZSAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZVtpICsgMl0uZm91ck1pc3NlZENsYXNzTXNnID09PSBmYWxzZSAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZVtpICsgM10uZm91ck1pc3NlZENsYXNzTXNnID09PSBmYWxzZSAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZVtpXS5hdHRlbmRhbmNlVmFsdWUgPT09ICdBJyAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZVtpICsgMV0uYXR0ZW5kYW5jZVZhbHVlID09PSAnQScgJiZcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBjb3Vyc2VbaSArIDJdLmF0dGVuZGFuY2VWYWx1ZSA9PT0gJ0EnICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY291cnNlW2kgKyAzXS5hdHRlbmRhbmNlVmFsdWUgPT09ICdBJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9tYXJrIGF0dGVuZGFuY2UgcmVjb3JkcyBhcyByZXZpZXdlZCBhbmQgbWVzc2FnZSBzZW50XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3Vyc2VbaV0uZm91ck1pc3NlZENsYXNzTXNnID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZVtpICsgMV0uZm91ck1pc3NlZENsYXNzTXNnID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZVtpICsgMl0uZm91ck1pc3NlZENsYXNzTXNnID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZVtpICsgM10uZm91ck1pc3NlZENsYXNzTXNnID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZVtpXS50d29NaXNzZWRDbGFzc01zZyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3Vyc2VbaSArIDFdLnR3b01pc3NlZENsYXNzTXNnID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZVtpICsgMl0udHdvTWlzc2VkQ2xhc3NNc2cgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291cnNlW2kgKyAzXS50d29NaXNzZWRDbGFzc01zZyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY291cnNlSW5mbyA9IGNvdXJzZXNSZXN1bHQuZmlsdGVyKHggPT4geC5jb3Vyc2VJRCA9PT0gY291cnNlW2ldLmNvdXJzZUlEKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJGb3VyIGNvbnNlY3V0aXZlIGNsYXNzZXMgbWlzc2VkIGJ5OiBcIiArIHN0dWRlbnQuZmlyc3ROYW1lICsgXCIgXCIgKyBzdHVkZW50Lmxhc3ROYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiU3R1ZGVudCBJRDogXCIgKyBjb3Vyc2VbaV0udXNlcklEICsgXCIgLSBcIiArIGNvdXJzZVtpICsgMV0udXNlcklEKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRGF0ZXM6IFwiICsgY291cnNlW2ldLmRhdGUgKyAnICYgJyArIGNvdXJzZVtpICsgMV0uZGF0ZSArICcgJiAnICsgY291cnNlW2kgKyAyXS5kYXRlICsgJyAmICcgKyBjb3Vyc2VbaSArIDNdLmRhdGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJDb3Vyc2UgSUQ6IFwiICsgY291cnNlW2ldLmNvdXJzZUlEICsgXCIgLSBcIiArIGNvdXJzZVtpICsgMV0uY291cnNlSUQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJFbWFpbDogXCIgKyB1c2VySW5mb1swXS5lbWFpbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX1wiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvdXJNaXNzZWRDbGFzc2VzICs9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgbWFpbE9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZyb206IGNvbmZpZy5tYWlsLnVzZXIsIC8vIHNlbmRlciBhZGRyZXNzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRvOiB1c2VySW5mb1swXS5lbWFpbCwgLy8gbGlzdCBvZiByZWNlaXZlcnNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc3ViamVjdDogJ1JlbW92YWwgZnJvbSAnICsgY291cnNlSW5mb1swXS5jb3Vyc2VOYW1lLCAvLyBTdWJqZWN0IGxpbmVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogJycsIC8vIHBsYWluIHRleHQgYm9keVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBodG1sOiAnSGkgJyArIHN0dWRlbnQuZmlyc3ROYW1lICsgJyw8YnIgLz48YnIgLz5PdXIgcmVjb3JkcyBpbmRpY2F0ZSB0aGF0IHlvdSBoYXZlIG1pc3NlZCA1MCUgb3IgbW9yZSBvZiB5b3VyICcgKyBjb3Vyc2VJbmZvWzBdLmNvdXJzZU5hbWUgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnIGNsYXNzZXMgaW4gdGhlIGxhc3QgZm91ciB3ZWVrcy4gT3VyIHBvbGljeSBzdGF0ZXMgdGhhdCBzdHVkZW50cyB3aWxsIGJlIHdpdGhkcmF3biB3aGVuIHRoaXMgbXVjaCB0aW1lIGhhcyBiZWVuIG1pc3NlZC4gVW5mb3J0dW5hdGVseSwgJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICd0aGlzIG1lYW5zIHRoYXQgeW91IGFyZSBiZWluZyBleGl0ZWQgZnJvbSAnICsgY291cnNlSW5mb1swXS5jb3Vyc2VOYW1lICsgJyBjbGFzcy48YnIgLz48YnIgLz5QbGVhc2UgY29udGFjdCBtZSBieSBwaG9uZSBhdCA3MDUtNzI4LTE5NjgsIEV4dC4gWFhYWCBvciBieSAnICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ2VtYWlsIGF0IDxhPkNoZXJ5bC5Cb3llc0BHZW9yZ2lhbkNvbGxlZ2UuY2E8L2E+IHRvIGNvbXBsZXRlIHRoZSBuZWNlc3NhcnkgcGFwZXJ3b3JrIGFuZCBkaXNjdXNzIHBvc3NpYmxlIG9wcG9ydHVuaXRpZXMgZm9yIHJldHVybmluZyB0byB0aGUgJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZUluZm9bMF0uY291cnNlTmFtZSArICcgY2xhc3MgYXQgYSBsYXRlciBkYXRlLjxiciAvPjxiciAvPlJlZ2FyZHMsPGJyIC8+PGJyIC8+PHN0cm9uZz5DaGVyeWwgQm95ZXM8L3N0cm9uZz48YnIgLz48c3Ryb25nPkFjYWRlbWljIFVwZ3JhZGluZyBPZmZpY2VyPC9zdHJvbmc+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8YnIgLz5HZW9yZ2lhbiBDb2xsZWdlfCBPbmUgR2VvcmdpYW4gRHJpdmUgfCBCYXJyaWUgT04gfCBMNE0gM1g5JyAvLyBodG1sIGJvZHlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcXVlcnkgPSBcIlVQREFURSBBdHRlbmRhbmNlIFNFVCBmb3VyTWlzc2VkQ2xhc3NNc2cgPSAndHJ1ZScsIHR3b01pc3NlZENsYXNzTXNnID0gJ3RydWUnIFdIRVJFIGF0dGVuZGFuY2VJRCBJTlwiICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIFwiICgnXCIgKyBjb3Vyc2VbaV0uYXR0ZW5kYW5jZUlEICsgXCInLCdcIiArIGNvdXJzZVtpICsgMV0uYXR0ZW5kYW5jZUlEICsgXCInLCdcIiArIGNvdXJzZVtpICsgMl0uYXR0ZW5kYW5jZUlEICsgXCInLCdcIiArIGNvdXJzZVtpICsgM10uYXR0ZW5kYW5jZUlEICsgXCInKVwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IHNxbC5SZXF1ZXN0KGNvbm5lY3Rpb24pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAucXVlcnkocXVlcnkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IHNxbC5SZXF1ZXN0KGNvbm5lY3Rpb24pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5xdWVyeShcIlVQREFURSBTdHVkZW50cyBTRVQgc3RhdHVzID0gNCBXSEVSRSB1c2VySUQgPSBcIiArIHN0dWRlbnQudXNlcklEKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgTWFpbFNlcnZpY2UoKS5zZW5kTWVzc2FnZSgnRm91ciBNaXNzZWQgQ2xhc3NlcycsIG1haWxPcHRpb25zKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgQWN0aXZpdHlTZXJ2aWNlKCkucmVwb3J0QWN0aXZpdHkoJ3NjaGVkdWxlZEVtYWlscycsICdGb3VyIE1pc3NlZCBDbGFzc2VzJywgJ3N1Y2Nlc3MnLCBzdHVkZW50LnVzZXJJRCwgJycsIHN0dWRlbnQuZmlyc3ROYW1lICsgJyAnICsgc3R1ZGVudC5sYXN0TmFtZSArICcgaGFzIG1pc3NlZCBmb3VyIGNvbnNlY3V0aXZlIGNsYXNzZXMgZm9yIHRoZSBmb2xsb3dpbmcgY291cnNlOiAnICsgY291cnNlSW5mb1swXS5jb3Vyc2VOYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJTY2hlZHVsZVNlcnZpY2UgLSBVcGRhdGUgc3R1ZGVudCBzdGF0dXM6IFwiICsgZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJTY2hlZHVsZVNlcnZpY2UgLSBVcGRhdGUgYXR0ZW5kYW5jZSByZWNvcmRzOiBcIiArIGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGNvdXJzZS5sZW5ndGggPj0gMiAmJiBjb3Vyc2VbaSArIDFdICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY291cnNlW2ldLmF0dGVuZGFuY2VWYWx1ZSA9PT0gJ0EnICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY291cnNlW2kgKyAxXS5hdHRlbmRhbmNlVmFsdWUgPT09ICdBJyAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZVtpXS50d29NaXNzZWRDbGFzc01zZyA9PT0gZmFsc2UgJiZcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBjb3Vyc2VbaSArIDFdLnR3b01pc3NlZENsYXNzTXNnID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgLy9tYXJrIGF0dGVuZGFuY2UgcmVjb3JkcyBhcyByZXZpZXdlZCBhbmQgbWVzc2FnZSBzZW50XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb3Vyc2VbaV0udHdvTWlzc2VkQ2xhc3NNc2cgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY291cnNlW2kgKyAxXS50d29NaXNzZWRDbGFzc01zZyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgY291cnNlSW5mbyA9IGNvdXJzZXNSZXN1bHQuZmlsdGVyKHggPT4geC5jb3Vyc2VJRCA9PT0gY291cnNlW2ldLmNvdXJzZUlEKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJUd28gY29uc2VjdXRpdmUgY2xhc3NlcyBoYXZlIGJlZW4gbWlzc2VkIGJ5OiBcIiArIHN0dWRlbnQuZmlyc3ROYW1lICsgXCIgXCIgKyBzdHVkZW50Lmxhc3ROYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiU3R1ZGVudCBJRDogXCIgKyBzdHVkZW50LnVzZXJJRCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkRhdGVzOiBcIiArIGNvdXJzZVtpXS5kYXRlICsgJyAmICcgKyBjb3Vyc2VbaSArIDFdLmRhdGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJDb3Vyc2UgSUQ6IFwiICsgY291cnNlW2ldLmNvdXJzZUlEICsgXCIgLSBcIiArIGNvdXJzZVtpICsgMV0uY291cnNlSUQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJFbWFpbDogXCIgKyB1c2VySW5mb1swXS5lbWFpbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX1wiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHR3b01pc3NlZENsYXNzZXMgKz0gMTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBtYWlsT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbTogY29uZmlnLm1haWwudXNlciwgLy8gc2VuZGVyIGFkZHJlc3NcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdG86IHVzZXJJbmZvWzBdLmVtYWlsLCAvLyBzdHVkZW50LmVtYWlsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1YmplY3Q6ICdUd28gTWlzc2VkICcgKyBjb3Vyc2VJbmZvWzBdLmNvdXJzZU5hbWUgKyAnIENsYXNzZXMnLCAvLyBTdWJqZWN0IGxpbmVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogJycsIC8vIHBsYWluIHRleHQgYm9keVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBodG1sOiAnSGkgJyArIHN0dWRlbnQuZmlyc3ROYW1lICsgJyw8YnIgLz48YnIgLz5JIG5vdGljZWQgdGhhdCB5b3UgbWlzc2VkIHRoZSBsYXN0IHR3byBjb25zZWN1dGl2ZSAnICsgY291cnNlSW5mb1swXS5jb3Vyc2VOYW1lICsgJyBjbGFzc2VzLicgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnIEkgaG9wZSBldmVyeXRoaW5nIGlzIG9rYXkuIExldCBtZSBrbm93IGlmIHRoZXJlIGlzIHNvbWV0aGluZyBJIGNhbiBkbyB0byBoZWxwLjxiciAvPjxiciAvPlBsZWFzZSBiZSByZW1pbmRlZCBvZiBvdXIgcHJvZ3JhbSAnICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3BvbGljeSB0aGF0IHN0YXRlcyBzdHVkZW50cyBhcmUgcmVzcG9uc2libGUgdG8gbm90aWZ5IHRoZWlyIGluc3RydWN0b3JzIHdoZW4gdGhleSB3aWxsIGJlIGFic2VudC4gSW4gYWRkaXRpb24sIHRoZSBwb2xpY3kgZGlyZWN0cyAnICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ3N0dWRlbnRzIHRvIGFycmFuZ2UgZm9yIGEgbGVhdmUgb2YgYWJzZW5jZSBpZiB0aGV5IG5lZWQgdG8gbWlzcyB0d28gb3IgbW9yZSBjbGFzc2VzIGluIGEgcm93LiBBIGxlYXZlIG9mIGFic2VuY2UgY2FuIGJlIGFycmFuZ2VkIHdpdGggJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdDaGVyeWwgQm95ZXMsIHdobyBjYW4gY29udGFjdGVkIGJ5IHBob25lIGF0IDcwNS03MjgtMTk2OCwgRXh0LiBYWFhYIG9yIGJ5IGVtYWlsIGF0IDxhPkNoZXJ5bC5Cb3llc0BHZW9yZ2lhbkNvbGxlZ2UuY2E8L2E+PGJyIC8+PGJyIC8+UGxlYXNlICcgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZ2V0IGluIHRvdWNoIHdpdGggbWUgYXMgc29vbiBhcyBwb3NzaWJsZS4gVW5mb3J0dW5hdGVseSwgaWYgSSBkb27igJl0IGhlYXIgZnJvbSB5b3UsIGFuZCB5b3UgbWlzcyB0aGUgbmV4dCB0d28gY2xhc3NlcywgeW91IHJpc2sgYmVpbmcgd2l0aGRyYXduICcgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnZnJvbSAnICsgY291cnNlSW5mb1swXS5jb3Vyc2VOYW1lICsgJy48YnIgLz48YnIgLz5CZXN0IFJlZ2FyZHMsPGJyIC8+PGJyIC8+PHN0cm9uZz5Kb2FubmUgUGluZWRhLCBNQSBBZEVkPC9zdHJvbmc+PGJyIC8+PHN0cm9uZz5BY2FkZW1pYyBQcmVwYXJhdGlvbiBGYWN1bHR5JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICc8L3N0cm9uZz48YnIgLz48YnIgLz5HZW9yZ2lhbiBDb2xsZWdlfCBPbmUgR2VvcmdpYW4gRHJpdmUgfCBCYXJyaWUgT04gfCBMNE0gM1g5JyAvLyBodG1sIGJvZHlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXIgcXVlcnkgPSBcIlVQREFURSBBdHRlbmRhbmNlIFNFVCB0d29NaXNzZWRDbGFzc01zZyA9ICd0cnVlJyBXSEVSRSBhdHRlbmRhbmNlSUQgSU4gKCdcIiArIGNvdXJzZVtpXS5hdHRlbmRhbmNlSUQgKyBcIicsJ1wiICsgY291cnNlW2kgKyAxXS5hdHRlbmRhbmNlSUQgKyBcIicpXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgc3FsLlJlcXVlc3QoY29ubmVjdGlvbilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5xdWVyeShxdWVyeSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgc3FsLlJlcXVlc3QoY29ubmVjdGlvbilcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLnF1ZXJ5KFwiVVBEQVRFIFN0dWRlbnRzIFNFVCBzdGF0dXMgPSAyIFdIRVJFIHVzZXJJRCA9IFwiICsgc3R1ZGVudC51c2VySUQpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBNYWlsU2VydmljZSgpLnNlbmRNZXNzYWdlKCdUd28gTWlzc2VkIENsYXNzZXMnLCBtYWlsT3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IEFjdGl2aXR5U2VydmljZSgpLnJlcG9ydEFjdGl2aXR5KCdzY2hlZHVsZWRFbWFpbHMnLCAnVHdvIE1pc3NlZCBDbGFzc2VzJywgJ3N1Y2Nlc3MnLCBzdHVkZW50LnVzZXJJRCwgJycsIHN0dWRlbnQuZmlyc3ROYW1lICsgJyAnICsgc3R1ZGVudC5sYXN0TmFtZSArICcgaGFzIG1pc3NlZCB0d28gY29uc2VjdXRpdmUgY2xhc3NlcyBmb3IgdGhlIGZvbGxvd2luZyBjb3Vyc2U6ICcgKyBjb3Vyc2VJbmZvWzBdLmNvdXJzZU5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlNjaGVkdWxlU2VydmljZSAtIFVwZGF0ZSBzdHVkZW50IHN0YXR1czogXCIgKyBlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlNjaGVkdWxlU2VydmljZSAtIFVwZGF0ZSBhdHRlbmRhbmNlOiBcIiArIGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgbGV0IG1haWxPcHRpb25zQWRtaW4gPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZnJvbTogJ2FjYWRlbWljLmNhcmVlci5wcmVwQGdtYWlsLmNvbScsIC8vIHNlbmRlciBhZGRyZXNzXHJcbiAgICAgICAgICAgICAgICAgICAgdG86ICdhY2FkZW1pYy5jYXJlZXIucHJlcEBnbWFpbC5jb20nLCAvLyBsaXN0IG9mIHJlY2VpdmVyc1xyXG4gICAgICAgICAgICAgICAgICAgIHN1YmplY3Q6ICdTQ0hFRFVMRVIg4pyUJywgLy8gU3ViamVjdCBsaW5lXHJcbiAgICAgICAgICAgICAgICAgICAgdGV4dDogJycsIC8vIHBsYWluIHRleHQgYm9keVxyXG4gICAgICAgICAgICAgICAgICAgIGh0bWw6ICc8Yj4gSGkgYWRtaW4hPC9iPjxiciAgLz48YnIgIC8+VGhlcmUgd2VyZSA8c3Ryb25nPicgKyB0d29NaXNzZWRDbGFzc2VzICsgJzwvc3Ryb25nPiBlbWFpbHMgc2VudCBvdXQgZHVlIHRvIG1pc3NlZCBjbGFzc2VzIHRvZGF5LiA8YnIvPiBUaGVyZSB3ZXJlIDxzdHJvbmc+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgZm91ck1pc3NlZENsYXNzZXMgKyAnPC9zdHJvbmc+IHJlbW92YWxzIGZyb20gYSBjb3Vyc2UgdG9kYXkuJyAvLyBodG1sIGJvZHlcclxuICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgbmV3IE1haWxTZXJ2aWNlKCkuc2VuZE1lc3NhZ2UoXCJTY2hlZHVsZWQgTWVzc2FnZVwiLCBtYWlsT3B0aW9uc0FkbWluKTtcclxuICAgICAgICAgICAgICAgICAgbmV3IEFjdGl2aXR5U2VydmljZSgpLnJlcG9ydEFjdGl2aXR5KCdzY2hlZHVsZWRFbWFpbHMnLCBleGVjdXRlVHlwZSArICcgLSBTY2hlZHVsZWQgQXR0ZW5kYW5jZSBDaGVjaycsICdzdWNjZXNzJywgJycsICcnLCBzdHVkZW50LmZpcnN0TmFtZSArICcgJyArIHN0dWRlbnQubGFzdE5hbWUgKyAnU2NoZWR1bGVkIGNoZWNrIG9mIHN0dWRlbnQgYXR0ZW5kYW5jZSBoYXMgY29tcGxldGVkIHN1Y2Nlc3NmdWxseSE8YnIvPlRoZXJlIHdlcmUgPHN0cm9uZz4nICsgdHdvTWlzc2VkQ2xhc3NlcyArICc8L3N0cm9uZz4gZW1haWxzIHNlbnQgZm9yIG1pc3NpbmcgdHdvIGNsYXNzZXMgaW4gYSByb3cuPGJyLz5UaGVyZSB3ZXJlIDxzdHJvbmc+JyArIGZvdXJNaXNzZWRDbGFzc2VzICsgJzwvc3Ryb25nPiBlbWFpbHMgc2VudCBmb3IgbWlzc2luZyBmb3VyIGNsYXNzZXMgaW4gYSByb3cuJyk7XHJcbiAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiVE9UQUwgV0FSTklORyBFTUFJTFMgU0VOVDogXCIgKyB0d29NaXNzZWRDbGFzc2VzKTtcclxuICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJUT1RBTCBSRU1PVkFMIEVNQUlMUyBTRU5UOiBcIiArIGZvdXJNaXNzZWRDbGFzc2VzKTtcclxuICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlNlbGVjdCBjb3Vyc2VJRCBhbmQgY291cnNlTmFtZSBmcm9tIGFsbCBjb3Vyc2VzIFwiICsgZXJyKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJTZWxlY3QgdXNlcklEIGFuZCBlbWFpbCBmcm9tIGFsbCB1c2VycyBcIiArIGVycik7XHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiU2VsZWN0IGFsbCBzdHVkZW50cyBcIiArIGVycik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiU2VsZWN0IHVzZXJJRCBhbmQgZW1haWwgZnJvbSBhbGwgdXNlcnMgXCIgKyBlcnIpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9XHJcbiAgICAgIGNhdGNoIChlcnIpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0ID0gU2NoZWR1bGVTZXJ2aWNlO1xyXG4iXX0=
