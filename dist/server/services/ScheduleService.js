var schedule = require('node-schedule');
var MailService = require("./MailService");
var sql = require('mssql');
var config = require('../config');
//runs every night at 7:30pm
var attendanceCheck = schedule.scheduleJob('0 30 19 * * *', function () {
    var date = new Date();
    var twoMissedClasses = 0, fourMissedClasses = 0;
    var student;
    try {
        sql.connect(config.db)
            .then(function (connection) {
            new sql.Request(connection)
                .query("SELECT * FROM Attendance ORDER BY date DESC")
                .then(function (attendanceResult) {
                new sql.Request(connection)
                    .query("SELECT userID, firstName, lastName FROM Students")
                    .then(function (studentsResult) {
                    new sql.Request(connection)
                        .query("SELECT userID, email FROM Users")
                        .then(function (usersResult) {
                        new sql.Request(connection)
                            .query("SELECT courseID, courseName FROM Course")
                            .then(function (coursesResult) {
                            var _loop_1 = function (student_1) {
                                userInfo = usersResult.filter(function (x) { return x.userID === student_1.userID; });
                                studentAttendance = attendanceResult.filter(function (x) { return x.userID === student_1.userID; });
                                console.log("# of attendance records for " + student_1.firstName + ": " + studentAttendance.length);
                                function courseBy(array, f) {
                                    var courses = {};
                                    array.forEach(function (o) {
                                        var course = JSON.stringify(f(o));
                                        courses[course] = courses[course] || [];
                                        courses[course].push(o);
                                    });
                                    return Object.keys(courses).map(function (course) {
                                        return courses[course];
                                    });
                                }
                                result = courseBy(studentAttendance, function (item) {
                                    return [item.courseID, item.userID];
                                });
                                var _loop_2 = function (course) {
                                    var _loop_3 = function () {
                                        availableCourses = course.filter(function (x) { return x.fourMissedClassMsg === false; });
                                        if (availableCourses.length >= 4 && course[i + 1] != null && course[i + 2] != null && course[i + 3] != null) {
                                            if (course[i].fourMissedClassMsg === false &&
                                                course[i + 1].fourMissedClassMsg === false &&
                                                course[i + 2].fourMissedClassMsg === false &&
                                                course[i + 3].fourMissedClassMsg === false &&
                                                course[i].attendanceValue === 'A' &&
                                                course[i + 1].attendanceValue === 'A' &&
                                                course[i + 2].attendanceValue === 'A' &&
                                                course[i + 3].attendanceValue === 'A') {
                                                //mark attendance records as reviewed and message sent
                                                course[i].fourMissedClassMsg = true;
                                                course[i + 1].fourMissedClassMsg = true;
                                                course[i + 2].fourMissedClassMsg = true;
                                                course[i + 3].fourMissedClassMsg = true;
                                                course[i].twoMissedClassMsg = true;
                                                course[i + 1].twoMissedClassMsg = true;
                                                course[i + 2].twoMissedClassMsg = true;
                                                course[i + 3].twoMissedClassMsg = true;
                                                courseInfo = coursesResult.filter(function (x) { return x.courseID === course[i].courseID; });
                                                console.log("__________________________________________________________________________________________");
                                                console.log("Four consecutive classes missed by: " + student_1.firstName + " " + student_1.lastName);
                                                console.log("Student ID: " + course[i].userID + " - " + course[i + 1].userID);
                                                console.log("Dates: " + course[i].date + ' & ' + course[i + 1].date + ' & ' + course[i + 2].date + ' & ' + course[i + 3].date);
                                                console.log("Course ID: " + course[i].courseID + " - " + course[i + 1].courseID);
                                                console.log("Email: " + userInfo[0].email);
                                                console.log("__________________________________________________________________________________________");
                                                fourMissedClasses += 1;
                                                var mailOptions_1 = {
                                                    from: config.mail.user,
                                                    to: userInfo[0].email,
                                                    subject: 'Removal from ' + courseInfo[0].courseName,
                                                    text: '',
                                                    html: 'Hi ' + student_1.firstName + ',<br /><br />Our records indicate that you have missed 50% or more of your ' + courseInfo[0].courseName +
                                                        ' classes in the last four weeks. Our policy states that students will be withdrawn when this much time has been missed. Unfortunately, ' +
                                                        'this means that you are being exited from ' + courseInfo[0].courseName + ' class.<br /><br />Please contact me by phone at 705-728-1968, Ext. XXXX or by ' +
                                                        'email at <a>Cheryl.Boyes@GeorgianCollege.ca</a> to complete the necessary paperwork and discuss possible opportunities for returning to the ' +
                                                        courseInfo[0].courseName + ' class at a later date.<br /><br />Regards,<br /><br /><strong>Cheryl Boyes</strong><br /><strong>Academic Upgrading Officer</strong>' +
                                                        '<br />Georgian College| One Georgian Drive | Barrie ON | L4M 3X9' // html body
                                                };
                                                query = "UPDATE Attendance SET fourMissedClassMsg = 'true', twoMissedClassMsg = 'true' WHERE attendanceID IN" +
                                                    " ('" + course[i].attendanceID + "','" + course[i + 1].attendanceID + "','" + course[i + 2].attendanceID + "','" + course[i + 3].attendanceID + "')";
                                                new sql.Request(connection)
                                                    .query(query)
                                                    .then(function (result) {
                                                    new MailService().sendMessage('Four Missed Classes', mailOptions_1);
                                                }).catch(function (err) {
                                                    console.log("Update attendance records: " + err);
                                                });
                                            }
                                        }
                                        if (course.length >= 2 && course[i + 1] != null) {
                                            if (course[i].attendanceValue === 'A' &&
                                                course[i + 1].attendanceValue === 'A' &&
                                                course[i].twoMissedClassMsg === false &&
                                                course[i + 1].twoMissedClassMsg === false) {
                                                //mark attendance records as reviewed and message sent
                                                course[i].twoMissedClassMsg = true;
                                                course[i + 1].twoMissedClassMsg = true;
                                                courseInfo = coursesResult.filter(function (x) { return x.courseID === course[i].courseID; });
                                                console.log("__________________________________________________________________________________________");
                                                console.log("Two consecutive classes have been missed by: " + student_1.firstName + " " + student_1.lastName);
                                                console.log("Student ID: " + course[i].userID + " - " + course[i + 1].userID);
                                                console.log("Dates: " + course[i].date + ' & ' + course[i + 1].date);
                                                console.log("Course ID: " + course[i].courseID + " - " + course[i + 1].courseID);
                                                console.log("Email: " + userInfo[0].email);
                                                console.log("__________________________________________________________________________________________");
                                                twoMissedClasses += 1;
                                                var mailOptions_2 = {
                                                    from: config.mail.user,
                                                    to: userInfo[0].email,
                                                    subject: 'Two Missed ' + courseInfo[0].courseName + ' Classes',
                                                    text: '',
                                                    html: 'Hi ' + student_1.firstName + ',<br /><br />I noticed that you missed the last two consecutive ' + courseInfo[0].courseName + ' classes.' +
                                                        ' I hope everything is okay. Let me know if there is something I can do to help.<br /><br />Please be reminded of our program ' +
                                                        'policy that states students are responsible to notify their instructors when they will be absent. In addition, the policy directs ' +
                                                        'students to arrange for a leave of absence if they need to miss two or more classes in a row. A leave of absence can be arranged with ' +
                                                        'Cheryl Boyes, who can contacted by phone at 705-728-1968, Ext. XXXX or by email at <a>Cheryl.Boyes@GeorgianCollege.ca</a><br /><br />Please ' +
                                                        'get in touch with me as soon as possible. Unfortunately, if I don’t hear from you, and you miss the next two classes, you risk being withdrawn ' +
                                                        'from ' + courseInfo[0].courseName + '.<br /><br />Best Regards,<br /><br /><strong>Joanne Pineda, MA AdEd</strong><br /><strong>Academic Preparation Faculty' +
                                                        '</strong><br /><br />Georgian College| One Georgian Drive | Barrie ON | L4M 3X9' // html body
                                                };
                                                query = "UPDATE Attendance SET twoMissedClassMsg = 'true' WHERE attendanceID IN ('" + course[i].attendanceID + "','" + course[i + 1].attendanceID + "')";
                                                new sql.Request(connection)
                                                    .query(query)
                                                    .then(function (result) {
                                                    new MailService().sendMessage('Two Missed Classes', mailOptions_2);
                                                }).catch(function (err) {
                                                    console.log("Select userID and email from all users " + err);
                                                });
                                            }
                                        }
                                    };
                                    for (var i = 0; i < course.length - 1; i++) {
                                        _loop_3();
                                    }
                                };
                                for (var _i = 0, result_1 = result; _i < result_1.length; _i++) {
                                    var course = result_1[_i];
                                    _loop_2(course);
                                }
                            };
                            var userInfo, studentAttendance, result, availableCourses, courseInfo, query, courseInfo, query;
                            for (var _i = 0, studentsResult_1 = studentsResult; _i < studentsResult_1.length; _i++) {
                                var student_1 = studentsResult_1[_i];
                                _loop_1(student_1);
                            }
                            var mailOptionsAdmin = {
                                from: 'academic.career.prep@gmail.com',
                                to: 'academic.career.prep@gmail.com',
                                subject: 'SCHEDULER ✔',
                                text: '',
                                html: '<b> Hi admin!</b><br  /><br  />There were <strong>' + twoMissedClasses + '</strong> emails sent out due to missed classes today. <br/> There were <strong>' +
                                    fourMissedClasses + '</strong> removals from a course today.' // html body
                            };
                            new MailService().sendMessage("Scheduled Message", mailOptionsAdmin);
                            console.log("TOTAL WARNING EMAILS SENT: " + twoMissedClasses);
                            console.log("TOTAL REMOVAL EMAILS SENT: " + fourMissedClasses);
                        }).catch(function (err) {
                            console.log("Select courseID and courseName from all courses " + err);
                        });
                    }).catch(function (err) {
                        console.log("Select userID and email from all users " + err);
                    });
                }).catch(function (err) {
                    console.log("Select all students " + err);
                });
            }).catch(function (err) {
                console.log("Get all attendance " + err);
            });
        }).catch(function (err) {
            console.log(err);
        });
    }
    catch (err) {
        console.log(err);
    }
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NlcnZlci9zcmMvc2VydmljZXMvU2NoZWR1bGVTZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLElBQU0sUUFBUSxHQUFHLE9BQU8sQ0FBQyxlQUFlLENBQUMsQ0FBQztBQUMxQyxJQUFNLFdBQVcsR0FBRyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUM7QUFDN0MsSUFBSSxHQUFHLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQzNCLElBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQztBQUVsQyw0QkFBNEI7QUFDNUIsSUFBSSxlQUFlLEdBQUcsUUFBUSxDQUFDLFdBQVcsQ0FBQyxlQUFlLEVBQUU7SUFDNUQsSUFBSSxJQUFJLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztJQUN0QixJQUFJLGdCQUFnQixHQUFHLENBQUMsRUFBRSxpQkFBaUIsR0FBRyxDQUFDLENBQUM7SUFDaEQsSUFBSSxPQUFPLENBQUM7SUFFWixJQUFJO1FBQ0YsR0FBRyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDO2FBQ3JCLElBQUksQ0FBQyxVQUFTLFVBQVU7WUFDdkIsSUFBSSxHQUFHLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQztpQkFDMUIsS0FBSyxDQUFDLDZDQUE2QyxDQUFDO2lCQUNwRCxJQUFJLENBQUMsVUFBUyxnQkFBZ0I7Z0JBQzdCLElBQUksR0FBRyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUM7cUJBQzFCLEtBQUssQ0FBQyxrREFBa0QsQ0FBQztxQkFDekQsSUFBSSxDQUFDLFVBQVMsY0FBYztvQkFDM0IsSUFBSSxHQUFHLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQzt5QkFDMUIsS0FBSyxDQUFDLGlDQUFpQyxDQUFDO3lCQUN4QyxJQUFJLENBQUMsVUFBUyxXQUFXO3dCQUN4QixJQUFJLEdBQUcsQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDOzZCQUMxQixLQUFLLENBQUMseUNB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QyxVQUFTLEdBQUc7d0JBQ25CLE9BQU8sQ0FBQyxHQUFHLENBQUMseUNBQXlDLEdBQUcsR0FBRyxDQUFDLENBQUM7b0JBQy9ELENBQUMsQ0FBQyxDQUFDO2dCQUNMLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxVQUFTLEdBQUc7b0JBQ25CLE9BQU8sQ0FBQyxHQUFHLENBQUMsc0JBQXNCLEdBQUcsR0FBRyxDQUFDLENBQUM7Z0JBQzVDLENBQUMsQ0FBQyxDQUFDO1lBQ0wsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLFVBQVMsR0FBRztnQkFDbkIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsR0FBRyxHQUFHLENBQUMsQ0FBQztZQUMzQyxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxVQUFTLEdBQUc7WUFDbkIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNuQixDQUFDLENBQUMsQ0FBQztLQUNKO0lBQ0QsT0FBTyxHQUFHLEVBQUU7UUFDVixPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0tBQ2xCO0FBRUgsQ0FBQyxDQUFDLENBQUMiLCJmaWxlIjoic2VydmljZXMvU2NoZWR1bGVTZXJ2aWNlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3Qgc2NoZWR1bGUgPSByZXF1aXJlKCdub2RlLXNjaGVkdWxlJyk7XHJcbmNvbnN0IE1haWxTZXJ2aWNlID0gcmVxdWlyZShcIi4vTWFpbFNlcnZpY2VcIik7XHJcbnZhciBzcWwgPSByZXF1aXJlKCdtc3NxbCcpO1xyXG52YXIgY29uZmlnID0gcmVxdWlyZSgnLi4vY29uZmlnJyk7XHJcblxyXG4vL3J1bnMgZXZlcnkgbmlnaHQgYXQgNzozMHBtXHJcbnZhciBhdHRlbmRhbmNlQ2hlY2sgPSBzY2hlZHVsZS5zY2hlZHVsZUpvYignMCAzMCAxOSAqICogKicsIGZ1bmN0aW9uKCkge1xyXG52YXIgZGF0ZSA9IG5ldyBEYXRlKCk7XHJcbnZhciB0d29NaXNzZWRDbGFzc2VzID0gMCwgZm91ck1pc3NlZENsYXNzZXMgPSAwO1xyXG52YXIgc3R1ZGVudDtcclxuXHJcbnRyeSB7XHJcbiAgc3FsLmNvbm5lY3QoY29uZmlnLmRiKVxyXG4gIC50aGVuKGZ1bmN0aW9uKGNvbm5lY3Rpb24pIHtcclxuICAgIG5ldyBzcWwuUmVxdWVzdChjb25uZWN0aW9uKVxyXG4gICAgLnF1ZXJ5KFwiU0VMRUNUICogRlJPTSBBdHRlbmRhbmNlIE9SREVSIEJZIGRhdGUgREVTQ1wiKVxyXG4gICAgLnRoZW4oZnVuY3Rpb24oYXR0ZW5kYW5jZVJlc3VsdCkge1xyXG4gICAgICBuZXcgc3FsLlJlcXVlc3QoY29ubmVjdGlvbilcclxuICAgICAgLnF1ZXJ5KFwiU0VMRUNUIHVzZXJJRCwgZmlyc3ROYW1lLCBsYXN0TmFtZSBGUk9NIFN0dWRlbnRzXCIpXHJcbiAgICAgIC50aGVuKGZ1bmN0aW9uKHN0dWRlbnRzUmVzdWx0KSB7XHJcbiAgICAgICAgbmV3IHNxbC5SZXF1ZXN0KGNvbm5lY3Rpb24pXHJcbiAgICAgICAgLnF1ZXJ5KFwiU0VMRUNUIHVzZXJJRCwgZW1haWwgRlJPTSBVc2Vyc1wiKVxyXG4gICAgICAgIC50aGVuKGZ1bmN0aW9uKHVzZXJzUmVzdWx0KSB7XHJcbiAgICAgICAgICBuZXcgc3FsLlJlcXVlc3QoY29ubmVjdGlvbilcclxuICAgICAgICAgIC5xdWVyeShcIlNFTEVDVCBjb3Vyc2VJRCwgY291cnNlTmFtZSBGUk9NIENvdXJzZVwiKVxyXG4gICAgICAgICAgLnRoZW4oZnVuY3Rpb24oY291cnNlc1Jlc3VsdCkge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBzdHVkZW50IG9mIHN0dWRlbnRzUmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgdmFyIHVzZXJJbmZvID0gdXNlcnNSZXN1bHQuZmlsdGVyKHggPT4geC51c2VySUQgPT09IHN0dWRlbnQudXNlcklEKTtcclxuICAgICAgICAgICAgICB2YXIgc3R1ZGVudEF0dGVuZGFuY2UgPSBhdHRlbmRhbmNlUmVzdWx0LmZpbHRlcih4ID0+IHgudXNlcklEID09PSBzdHVkZW50LnVzZXJJRCk7XHJcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coXCIjIG9mIGF0dGVuZGFuY2UgcmVjb3JkcyBmb3IgXCIgKyBzdHVkZW50LmZpcnN0TmFtZSArIFwiOiBcIiArIHN0dWRlbnRBdHRlbmRhbmNlLmxlbmd0aCk7XHJcbiAgICAgICAgICAgICAgZnVuY3Rpb24gY291cnNlQnkoYXJyYXksIGYpIHtcclxuICAgICAgICAgICAgICAgIHZhciBjb3Vyc2VzID0ge307XHJcbiAgICAgICAgICAgICAgICBhcnJheS5mb3JFYWNoKGZ1bmN0aW9uKG8pIHtcclxuICAgICAgICAgICAgICAgICAgdmFyIGNvdXJzZSA9IEpTT04uc3RyaW5naWZ5KGYobykpO1xyXG4gICAgICAgICAgICAgICAgICBjb3Vyc2VzW2NvdXJzZV0gPSBjb3Vyc2VzW2NvdXJzZV0gfHwgW107XHJcbiAgICAgICAgICAgICAgICAgIGNvdXJzZXNbY291cnNlXS5wdXNoKG8pO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gT2JqZWN0LmtleXMoY291cnNlcykubWFwKGZ1bmN0aW9uKGNvdXJzZSkge1xyXG4gICAgICAgICAgICAgICAgICByZXR1cm4gY291cnNlc1tjb3Vyc2VdO1xyXG4gICAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGNvdXJzZUJ5KHN0dWRlbnRBdHRlbmRhbmNlLCBmdW5jdGlvbihpdGVtKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gW2l0ZW0uY291cnNlSUQsIGl0ZW0udXNlcklEXTtcclxuICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICBmb3IgKGxldCBjb3Vyc2Ugb2YgcmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvdXJzZS5sZW5ndGggLSAxOyBpKyspIHtcclxuICAgICAgICAgICAgICAgICAgdmFyIGF2YWlsYWJsZUNvdXJzZXMgPSBjb3Vyc2UuZmlsdGVyKHggPT4geC5mb3VyTWlzc2VkQ2xhc3NNc2cgPT09IGZhbHNlKTtcclxuICAgICAgICAgICAgICAgICAgaWYgKGF2YWlsYWJsZUNvdXJzZXMubGVuZ3RoID49IDQgJiYgY291cnNlW2kgKyAxXSAhPSBudWxsICYmIGNvdXJzZVtpICsgMl0gIT0gbnVsbCAmJiBjb3Vyc2VbaSArIDNdICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY291cnNlW2ldLmZvdXJNaXNzZWRDbGFzc01zZyA9PT0gZmFsc2UgJiZcclxuICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZVtpICsgMV0uZm91ck1pc3NlZENsYXNzTXNnID09PSBmYWxzZSAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgY291cnNlW2kgKyAyXS5mb3VyTWlzc2VkQ2xhc3NNc2cgPT09IGZhbHNlICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICBjb3Vyc2VbaSArIDNdLmZvdXJNaXNzZWRDbGFzc01zZyA9PT0gZmFsc2UgJiZcclxuICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZVtpXS5hdHRlbmRhbmNlVmFsdWUgPT09ICdBJyAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgY291cnNlW2kgKyAxXS5hdHRlbmRhbmNlVmFsdWUgPT09ICdBJyAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgY291cnNlW2kgKyAyXS5hdHRlbmRhbmNlVmFsdWUgPT09ICdBJyAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgY291cnNlW2kgKyAzXS5hdHRlbmRhbmNlVmFsdWUgPT09ICdBJykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL21hcmsgYXR0ZW5kYW5jZSByZWNvcmRzIGFzIHJldmlld2VkIGFuZCBtZXNzYWdlIHNlbnRcclxuICAgICAgICAgICAgICAgICAgICAgICAgY291cnNlW2ldLmZvdXJNaXNzZWRDbGFzc01zZyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZVtpICsgMV0uZm91ck1pc3NlZENsYXNzTXNnID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY291cnNlW2kgKyAyXS5mb3VyTWlzc2VkQ2xhc3NNc2cgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3Vyc2VbaSArIDNdLmZvdXJNaXNzZWRDbGFzc01zZyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZVtpXS50d29NaXNzZWRDbGFzc01zZyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZVtpICsgMV0udHdvTWlzc2VkQ2xhc3NNc2cgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3Vyc2VbaSArIDJdLnR3b01pc3NlZENsYXNzTXNnID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY291cnNlW2kgKyAzXS50d29NaXNzZWRDbGFzc01zZyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb3Vyc2VJbmZvID0gY291cnNlc1Jlc3VsdC5maWx0ZXIoeCA9PiB4LmNvdXJzZUlEID09PSBjb3Vyc2VbaV0uY291cnNlSUQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX1wiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJGb3VyIGNvbnNlY3V0aXZlIGNsYXNzZXMgbWlzc2VkIGJ5OiBcIiArIHN0dWRlbnQuZmlyc3ROYW1lICsgXCIgXCIgKyBzdHVkZW50Lmxhc3ROYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJTdHVkZW50IElEOiBcIiArIGNvdXJzZVtpXS51c2VySUQgKyBcIiAtIFwiICsgY291cnNlW2kgKyAxXS51c2VySUQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkRhdGVzOiBcIiArIGNvdXJzZVtpXS5kYXRlICsgJyAmICcgKyBjb3Vyc2VbaSArIDFdLmRhdGUgKyAnICYgJyArIGNvdXJzZVtpICsgMl0uZGF0ZSArICcgJiAnICsgY291cnNlW2kgKyAzXS5kYXRlKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJDb3Vyc2UgSUQ6IFwiICsgY291cnNlW2ldLmNvdXJzZUlEICsgXCIgLSBcIiArIGNvdXJzZVtpICsgMV0uY291cnNlSUQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkVtYWlsOiBcIiArIHVzZXJJbmZvWzBdLmVtYWlsKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvdXJNaXNzZWRDbGFzc2VzICs9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBtYWlsT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tOiBjb25maWcubWFpbC51c2VyLCAvLyBzZW5kZXIgYWRkcmVzc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHRvOiB1c2VySW5mb1swXS5lbWFpbCwgLy8gbGlzdCBvZiByZWNlaXZlcnNcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJqZWN0OiAnUmVtb3ZhbCBmcm9tICcgKyBjb3Vyc2VJbmZvWzBdLmNvdXJzZU5hbWUsIC8vIFN1YmplY3QgbGluZVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHRleHQ6ICcnLCAvLyBwbGFpbiB0ZXh0IGJvZHlcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBodG1sOiAnSGkgJyArIHN0dWRlbnQuZmlyc3ROYW1lICsgJyw8YnIgLz48YnIgLz5PdXIgcmVjb3JkcyBpbmRpY2F0ZSB0aGF0IHlvdSBoYXZlIG1pc3NlZCA1MCUgb3IgbW9yZSBvZiB5b3VyICcgKyBjb3Vyc2VJbmZvWzBdLmNvdXJzZU5hbWUgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICcgY2xhc3NlcyBpbiB0aGUgbGFzdCBmb3VyIHdlZWtzLiBPdXIgcG9saWN5IHN0YXRlcyB0aGF0IHN0dWRlbnRzIHdpbGwgYmUgd2l0aGRyYXduIHdoZW4gdGhpcyBtdWNoIHRpbWUgaGFzIGJlZW4gbWlzc2VkLiBVbmZvcnR1bmF0ZWx5LCAnICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAndGhpcyBtZWFucyB0aGF0IHlvdSBhcmUgYmVpbmcgZXhpdGVkIGZyb20gJyArIGNvdXJzZUluZm9bMF0uY291cnNlTmFtZSArICcgY2xhc3MuPGJyIC8+PGJyIC8+UGxlYXNlIGNvbnRhY3QgbWUgYnkgcGhvbmUgYXQgNzA1LTcyOC0xOTY4LCBFeHQuIFhYWFggb3IgYnkgJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJ2VtYWlsIGF0IDxhPkNoZXJ5bC5Cb3llc0BHZW9yZ2lhbkNvbGxlZ2UuY2E8L2E+IHRvIGNvbXBsZXRlIHRoZSBuZWNlc3NhcnkgcGFwZXJ3b3JrIGFuZCBkaXNjdXNzIHBvc3NpYmxlIG9wcG9ydHVuaXRpZXMgZm9yIHJldHVybmluZyB0byB0aGUgJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY291cnNlSW5mb1swXS5jb3Vyc2VOYW1lICsgJyBjbGFzcyBhdCBhIGxhdGVyIGRhdGUuPGJyIC8+PGJyIC8+UmVnYXJkcyw8YnIgLz48YnIgLz48c3Ryb25nPkNoZXJ5bCBCb3llczwvc3Ryb25nPjxiciAvPjxzdHJvbmc+QWNhZGVtaWMgVXBncmFkaW5nIE9mZmljZXI8L3N0cm9uZz4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAnPGJyIC8+R2VvcmdpYW4gQ29sbGVnZXwgT25lIEdlb3JnaWFuIERyaXZlIHwgQmFycmllIE9OIHwgTDRNIDNYOScgLy8gaHRtbCBib2R5XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBxdWVyeSA9IFwiVVBEQVRFIEF0dGVuZGFuY2UgU0VUIGZvdXJNaXNzZWRDbGFzc01zZyA9ICd0cnVlJywgdHdvTWlzc2VkQ2xhc3NNc2cgPSAndHJ1ZScgV0hFUkUgYXR0ZW5kYW5jZUlEIElOXCIgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBcIiAoJ1wiICsgY291cnNlW2ldLmF0dGVuZGFuY2VJRCArIFwiJywnXCIgKyBjb3Vyc2VbaSArIDFdLmF0dGVuZGFuY2VJRCArIFwiJywnXCIgKyBjb3Vyc2VbaSArIDJdLmF0dGVuZGFuY2VJRCArIFwiJywnXCIgKyBjb3Vyc2VbaSArIDNdLmF0dGVuZGFuY2VJRCArIFwiJylcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IHNxbC5SZXF1ZXN0KGNvbm5lY3Rpb24pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5xdWVyeShxdWVyeSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE1haWxTZXJ2aWNlKCkuc2VuZE1lc3NhZ2UoJ0ZvdXIgTWlzc2VkIENsYXNzZXMnLCBtYWlsT3B0aW9ucyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiVXBkYXRlIGF0dGVuZGFuY2UgcmVjb3JkczogXCIgKyBlcnIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvdXJzZS5sZW5ndGggPj0gMiAmJiBjb3Vyc2VbaSArIDFdICE9IG51bGwpIHtcclxuICAgICAgICAgICAgICAgICAgICAgIGlmIChjb3Vyc2VbaV0uYXR0ZW5kYW5jZVZhbHVlID09PSAnQScgJiZcclxuICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZVtpICsgMV0uYXR0ZW5kYW5jZVZhbHVlID09PSAnQScgJiZcclxuICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZVtpXS50d29NaXNzZWRDbGFzc01zZyA9PT0gZmFsc2UgJiZcclxuICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZVtpICsgMV0udHdvTWlzc2VkQ2xhc3NNc2cgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vbWFyayBhdHRlbmRhbmNlIHJlY29yZHMgYXMgcmV2aWV3ZWQgYW5kIG1lc3NhZ2Ugc2VudFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3Vyc2VbaV0udHdvTWlzc2VkQ2xhc3NNc2cgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3Vyc2VbaSArIDFdLnR3b01pc3NlZENsYXNzTXNnID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNvdXJzZUluZm8gPSBjb3Vyc2VzUmVzdWx0LmZpbHRlcih4ID0+IHguY291cnNlSUQgPT09IGNvdXJzZVtpXS5jb3Vyc2VJRCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlR3byBjb25zZWN1dGl2ZSBjbGFzc2VzIGhhdmUgYmVlbiBtaXNzZWQgYnk6IFwiICsgc3R1ZGVudC5maXJzdE5hbWUgKyBcIiBcIiArIHN0dWRlbnQubGFzdE5hbWUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlN0dWRlbnQgSUQ6IFwiICsgY291cnNlW2ldLnVzZXJJRCArIFwiIC0gXCIgKyBjb3Vyc2VbaSArIDFdLnVzZXJJRCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRGF0ZXM6IFwiICsgY291cnNlW2ldLmRhdGUgKyAnICYgJyArIGNvdXJzZVtpICsgMV0uZGF0ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiQ291cnNlIElEOiBcIiArIGNvdXJzZVtpXS5jb3Vyc2VJRCArIFwiIC0gXCIgKyBjb3Vyc2VbaSArIDFdLmNvdXJzZUlEKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJFbWFpbDogXCIgKyB1c2VySW5mb1swXS5lbWFpbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0d29NaXNzZWRDbGFzc2VzICs9IDE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBtYWlsT3B0aW9ucyA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBmcm9tOiBjb25maWcubWFpbC51c2VyLCAvLyBzZW5kZXIgYWRkcmVzc1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHRvOiB1c2VySW5mb1swXS5lbWFpbCwgLy8gc3R1ZGVudC5lbWFpbFxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHN1YmplY3Q6ICdUd28gTWlzc2VkICcgKyBjb3Vyc2VJbmZvWzBdLmNvdXJzZU5hbWUgKyAnIENsYXNzZXMnLCAvLyBTdWJqZWN0IGxpbmVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnJywgLy8gcGxhaW4gdGV4dCBib2R5XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgaHRtbDogJ0hpICcgKyBzdHVkZW50LmZpcnN0TmFtZSArICcsPGJyIC8+PGJyIC8+SSBub3RpY2VkIHRoYXQgeW91IG1pc3NlZCB0aGUgbGFzdCB0d28gY29uc2VjdXRpdmUgJyArIGNvdXJzZUluZm9bMF0uY291cnNlTmFtZSArICcgY2xhc3Nlcy4nICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAnIEkgaG9wZSBldmVyeXRoaW5nIGlzIG9rYXkuIExldCBtZSBrbm93IGlmIHRoZXJlIGlzIHNvbWV0aGluZyBJIGNhbiBkbyB0byBoZWxwLjxiciAvPjxiciAvPlBsZWFzZSBiZSByZW1pbmRlZCBvZiBvdXIgcHJvZ3JhbSAnICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAncG9saWN5IHRoYXQgc3RhdGVzIHN0dWRlbnRzIGFyZSByZXNwb25zaWJsZSB0byBub3RpZnkgdGhlaXIgaW5zdHJ1Y3RvcnMgd2hlbiB0aGV5IHdpbGwgYmUgYWJzZW50LiBJbiBhZGRpdGlvbiwgdGhlIHBvbGljeSBkaXJlY3RzICcgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICdzdHVkZW50cyB0byBhcnJhbmdlIGZvciBhIGxlYXZlIG9mIGFic2VuY2UgaWYgdGhleSBuZWVkIHRvIG1pc3MgdHdvIG9yIG1vcmUgY2xhc3NlcyBpbiBhIHJvdy4gQSBsZWF2ZSBvZiBhYnNlbmNlIGNhbiBiZSBhcnJhbmdlZCB3aXRoICcgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICdDaGVyeWwgQm95ZXMsIHdobyBjYW4gY29udGFjdGVkIGJ5IHBob25lIGF0IDcwNS03MjgtMTk2OCwgRXh0LiBYWFhYIG9yIGJ5IGVtYWlsIGF0IDxhPkNoZXJ5bC5Cb3llc0BHZW9yZ2lhbkNvbGxlZ2UuY2E8L2E+PGJyIC8+PGJyIC8+UGxlYXNlICcgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICdnZXQgaW4gdG91Y2ggd2l0aCBtZSBhcyBzb29uIGFzIHBvc3NpYmxlLiBVbmZvcnR1bmF0ZWx5LCBpZiBJIGRvbuKAmXQgaGVhciBmcm9tIHlvdSwgYW5kIHlvdSBtaXNzIHRoZSBuZXh0IHR3byBjbGFzc2VzLCB5b3UgcmlzayBiZWluZyB3aXRoZHJhd24gJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJ2Zyb20gJyArIGNvdXJzZUluZm9bMF0uY291cnNlTmFtZSArICcuPGJyIC8+PGJyIC8+QmVzdCBSZWdhcmRzLDxiciAvPjxiciAvPjxzdHJvbmc+Sm9hbm5lIFBpbmVkYSwgTUEgQWRFZDwvc3Ryb25nPjxiciAvPjxzdHJvbmc+QWNhZGVtaWMgUHJlcGFyYXRpb24gRmFjdWx0eScgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICc8L3N0cm9uZz48YnIgLz48YnIgLz5HZW9yZ2lhbiBDb2xsZWdlfCBPbmUgR2VvcmdpYW4gRHJpdmUgfCBCYXJyaWUgT04gfCBMNE0gM1g5JyAvLyBodG1sIGJvZHlcclxuICAgICAgICAgICAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHF1ZXJ5ID0gXCJVUERBVEUgQXR0ZW5kYW5jZSBTRVQgdHdvTWlzc2VkQ2xhc3NNc2cgPSAndHJ1ZScgV0hFUkUgYXR0ZW5kYW5jZUlEIElOICgnXCIgKyBjb3Vyc2VbaV0uYXR0ZW5kYW5jZUlEICsgXCInLCdcIiArIGNvdXJzZVtpICsgMV0uYXR0ZW5kYW5jZUlEICsgXCInKVwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgc3FsLlJlcXVlc3QoY29ubmVjdGlvbilcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnF1ZXJ5KHF1ZXJ5KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAudGhlbihmdW5jdGlvbihyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgTWFpbFNlcnZpY2UoKS5zZW5kTWVzc2FnZSgnVHdvIE1pc3NlZCBDbGFzc2VzJywgbWFpbE9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlNlbGVjdCB1c2VySUQgYW5kIGVtYWlsIGZyb20gYWxsIHVzZXJzIFwiICsgZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIGxldCBtYWlsT3B0aW9uc0FkbWluID0ge1xyXG4gICAgICAgICAgICAgICAgZnJvbTogJ2FjYWRlbWljLmNhcmVlci5wcmVwQGdtYWlsLmNvbScsIC8vIHNlbmRlciBhZGRyZXNzXHJcbiAgICAgICAgICAgICAgICB0bzogJ2FjYWRlbWljLmNhcmVlci5wcmVwQGdtYWlsLmNvbScsIC8vIGxpc3Qgb2YgcmVjZWl2ZXJzXHJcbiAgICAgICAgICAgICAgICBzdWJqZWN0OiAnU0NIRURVTEVSIOKclCcsIC8vIFN1YmplY3QgbGluZVxyXG4gICAgICAgICAgICAgICAgdGV4dDogJycsIC8vIHBsYWluIHRleHQgYm9keVxyXG4gICAgICAgICAgICAgICAgaHRtbDogJzxiPiBIaSBhZG1pbiE8L2I+PGJyICAvPjxiciAgLz5UaGVyZSB3ZXJlIDxzdHJvbmc+JyArIHR3b01pc3NlZENsYXNzZXMgKyAnPC9zdHJvbmc+IGVtYWlscyBzZW50IG91dCBkdWUgdG8gbWlzc2VkIGNsYXNzZXMgdG9kYXkuIDxici8+IFRoZXJlIHdlcmUgPHN0cm9uZz4nICtcclxuICAgICAgICAgICAgICAgIGZvdXJNaXNzZWRDbGFzc2VzICsgJzwvc3Ryb25nPiByZW1vdmFscyBmcm9tIGEgY291cnNlIHRvZGF5LicgLy8gaHRtbCBib2R5XHJcbiAgICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgICBuZXcgTWFpbFNlcnZpY2UoKS5zZW5kTWVzc2FnZShcIlNjaGVkdWxlZCBNZXNzYWdlXCIsIG1haWxPcHRpb25zQWRtaW4pO1xyXG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiVE9UQUwgV0FSTklORyBFTUFJTFMgU0VOVDogXCIgKyB0d29NaXNzZWRDbGFzc2VzKTtcclxuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlRPVEFMIFJFTU9WQUwgRU1BSUxTIFNFTlQ6IFwiICsgZm91ck1pc3NlZENsYXNzZXMpO1xyXG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlNlbGVjdCBjb3Vyc2VJRCBhbmQgY291cnNlTmFtZSBmcm9tIGFsbCBjb3Vyc2VzIFwiICsgZXJyKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJTZWxlY3QgdXNlcklEIGFuZCBlbWFpbCBmcm9tIGFsbCB1c2VycyBcIiArIGVycik7XHJcbiAgICAgICAgICB9KTtcclxuICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgIGNvbnNvbGUubG9nKFwiU2VsZWN0IGFsbCBzdHVkZW50cyBcIiArIGVycik7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKGVycikge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKFwiR2V0IGFsbCBhdHRlbmRhbmNlIFwiICsgZXJyKTtcclxuICAgICAgfSk7XHJcbiAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgY29uc29sZS5sb2coZXJyKTtcclxuICAgIH0pO1xyXG4gIH1cclxuICBjYXRjaCAoZXJyKSB7XHJcbiAgICBjb25zb2xlLmxvZyhlcnIpO1xyXG4gIH1cclxuXHJcbn0pO1xyXG4iXX0=
