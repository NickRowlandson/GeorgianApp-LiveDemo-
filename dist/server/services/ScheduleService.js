var schedule = require('node-schedule');
var MailService = require("./MailService");
var sql = require('mssql');
var config = require('../config');
//runs every night at 10pm
var attendanceCheck = schedule.scheduleJob('0 30 19 * * *', function () {
    var date = new Date();
    var twoMissedClasses = 0, fourMissedClasses = 0;
    var student;
    try {
        sql.connect(config.db)
            .then(function (connection) {
            new sql.Request(connection)
                .query("SELECT * FROM Attendance ORDER BY date DESC")
                .then(function (attendanceResult) {
                new sql.Request(connection)
                    .query("SELECT userID, firstName, lastName FROM Students")
                    .then(function (studentsResult) {
                    new sql.Request(connection)
                        .query("SELECT userID, email FROM Users")
                        .then(function (usersResult) {
                        new sql.Request(connection)
                            .query("SELECT courseID, courseName FROM Course")
                            .then(function (coursesResult) {
                            var _loop_1 = function (student_1) {
                                userInfo = usersResult.filter(function (x) { return x.userID === student_1.userID; });
                                studentAttendance = attendanceResult.filter(function (x) { return x.userID === student_1.userID; });
                                console.log("# of attendance records for " + student_1.firstName + ": " + studentAttendance.length);
                                function courseBy(array, f) {
                                    var courses = {};
                                    array.forEach(function (o) {
                                        var course = JSON.stringify(f(o));
                                        courses[course] = courses[course] || [];
                                        courses[course].push(o);
                                    });
                                    return Object.keys(courses).map(function (course) {
                                        return courses[course];
                                    });
                                }
                                result = courseBy(studentAttendance, function (item) {
                                    return [item.courseID, item.userID];
                                });
                                var _loop_2 = function (course) {
                                    var _loop_3 = function () {
                                        availableCourses = course.filter(function (x) { return x.fourMissedClassMsg === false; });
                                        if (availableCourses.length >= 4 && course[i + 1] != null && course[i + 2] != null && course[i + 3] != null) {
                                            if (course[i].fourMissedClassMsg === false &&
                                                course[i + 1].fourMissedClassMsg === false &&
                                                course[i + 2].fourMissedClassMsg === false &&
                                                course[i + 3].fourMissedClassMsg === false &&
                                                course[i].attendanceValue === 'A' &&
                                                course[i + 1].attendanceValue === 'A' &&
                                                course[i + 2].attendanceValue === 'A' &&
                                                course[i + 3].attendanceValue === 'A') {
                                                //mark attendance records as reviewed and message sent
                                                course[i].fourMissedClassMsg = true;
                                                course[i + 1].fourMissedClassMsg = true;
                                                course[i + 2].fourMissedClassMsg = true;
                                                course[i + 3].fourMissedClassMsg = true;
                                                course[i].twoMissedClassMsg = true;
                                                course[i + 1].twoMissedClassMsg = true;
                                                course[i + 2].twoMissedClassMsg = true;
                                                course[i + 3].twoMissedClassMsg = true;
                                                courseInfo = coursesResult.filter(function (x) { return x.courseID === course[i].courseID; });
                                                console.log("__________________________________________________________________________________________");
                                                console.log("Four consecutive classes missed by: " + student_1.firstName + " " + student_1.lastName);
                                                console.log("Student ID: " + course[i].userID + " - " + course[i + 1].userID);
                                                console.log("Dates: " + course[i].date + ' & ' + course[i + 1].date + ' & ' + course[i + 2].date + ' & ' + course[i + 3].date);
                                                console.log("Course ID: " + course[i].courseID + " - " + course[i + 1].courseID);
                                                console.log("Email: " + userInfo[0].email);
                                                console.log("__________________________________________________________________________________________");
                                                fourMissedClasses += 1;
                                                var mailOptions_1 = {
                                                    from: config.mail.user,
                                                    to: userInfo[0].email,
                                                    subject: 'Removal from ' + courseInfo[0].courseName,
                                                    text: '',
                                                    html: 'Hi ' + student_1.firstName + ',<br /><br />Our records indicate that you have missed 50% or more of your ' + courseInfo[0].courseName +
                                                        ' classes in the last four weeks. Our policy states that students will be withdrawn when this much time has been missed. Unfortunately, ' +
                                                        'this means that you are being exited from ' + courseInfo[0].courseName + ' class.<br /><br />Please contact me by phone at 705-728-1968, Ext. XXXX or by ' +
                                                        'email at <a>Cheryl.Boyes@GeorgianCollege.ca</a> to complete the necessary paperwork and discuss possible opportunities for returning to the ' +
                                                        courseInfo[0].courseName + ' class at a later date.<br /><br />Regards,<br /><br /><strong>Cheryl Boyes</strong><br /><strong>Academic Upgrading Officer</strong>' +
                                                        '<br />Georgian College| One Georgian Drive | Barrie ON | L4M 3X9' // html body
                                                };
                                                query = "UPDATE Attendance SET fourMissedClassMsg = 'true', twoMissedClassMsg = 'true' WHERE attendanceID IN" +
                                                    " ('" + course[i].attendanceID + "','" + course[i + 1].attendanceID + "','" + course[i + 2].attendanceID + "','" + course[i + 3].attendanceID + "')";
                                                new sql.Request(connection)
                                                    .query(query)
                                                    .then(function (result) {
                                                    new MailService().sendMessage('Four Missed Classes', mailOptions_1);
                                                }).catch(function (err) {
                                                    console.log("Update attendance records: " + err);
                                                });
                                            }
                                        }
                                        if (course.length >= 2 && course[i + 1] != null) {
                                            if (course[i].attendanceValue === 'A' &&
                                                course[i + 1].attendanceValue === 'A' &&
                                                course[i].twoMissedClassMsg === false &&
                                                course[i + 1].twoMissedClassMsg === false) {
                                                //mark attendance records as reviewed and message sent
                                                course[i].twoMissedClassMsg = true;
                                                course[i + 1].twoMissedClassMsg = true;
                                                courseInfo = coursesResult.filter(function (x) { return x.courseID === course[i].courseID; });
                                                console.log("__________________________________________________________________________________________");
                                                console.log("Two consecutive classes have been missed by: " + student_1.firstName + " " + student_1.lastName);
                                                console.log("Student ID: " + course[i].userID + " - " + course[i + 1].userID);
                                                console.log("Dates: " + course[i].date + ' & ' + course[i + 1].date);
                                                console.log("Course ID: " + course[i].courseID + " - " + course[i + 1].courseID);
                                                console.log("Email: " + userInfo[0].email);
                                                console.log("__________________________________________________________________________________________");
                                                twoMissedClasses += 1;
                                                var mailOptions_2 = {
                                                    from: config.mail.user,
                                                    to: userInfo[0].email,
                                                    subject: 'Two Missed ' + courseInfo[0].courseName + ' Classes',
                                                    text: '',
                                                    html: 'Hi ' + student_1.firstName + ',<br /><br />I noticed that you missed the last two consecutive ' + courseInfo[0].courseName + ' classes.' +
                                                        ' I hope everything is okay. Let me know if there is something I can do to help.<br /><br />Please be reminded of our program ' +
                                                        'policy that states students are responsible to notify their instructors when they will be absent. In addition, the policy directs ' +
                                                        'students to arrange for a leave of absence if they need to miss two or more classes in a row. A leave of absence can be arranged with ' +
                                                        'Cheryl Boyes, who can contacted by phone at 705-728-1968, Ext. XXXX or by email at <a>Cheryl.Boyes@GeorgianCollege.ca</a><br /><br />Please ' +
                                                        'get in touch with me as soon as possible. Unfortunately, if I don’t hear from you, and you miss the next two classes, you risk being withdrawn ' +
                                                        'from ' + courseInfo[0].courseName + '.<br /><br />Best Regards,<br /><br /><strong>Joanne Pineda, MA AdEd</strong><br /><strong>Academic Preparation Faculty' +
                                                        '</strong><br /><br />Georgian College| One Georgian Drive | Barrie ON | L4M 3X9' // html body
                                                };
                                                query = "UPDATE Attendance SET twoMissedClassMsg = 'true' WHERE attendanceID IN ('" + course[i].attendanceID + "','" + course[i + 1].attendanceID + "')";
                                                new sql.Request(connection)
                                                    .query(query)
                                                    .then(function (result) {
                                                    new MailService().sendMessage('Two Missed Classes', mailOptions_2);
                                                }).catch(function (err) {
                                                    console.log("Select userID and email from all users " + err);
                                                });
                                            }
                                        }
                                    };
                                    for (var i = 0; i < course.length - 1; i++) {
                                        _loop_3();
                                    }
                                };
                                for (var _i = 0, result_1 = result; _i < result_1.length; _i++) {
                                    var course = result_1[_i];
                                    _loop_2(course);
                                }
                            };
                            var userInfo, studentAttendance, result, availableCourses, courseInfo, query, courseInfo, query;
                            for (var _i = 0, studentsResult_1 = studentsResult; _i < studentsResult_1.length; _i++) {
                                var student_1 = studentsResult_1[_i];
                                _loop_1(student_1);
                            }
                            var mailOptionsAdmin = {
                                from: 'academic.career.prep@gmail.com',
                                to: 'academic.career.prep@gmail.com',
                                subject: 'SCHEDULER ✔',
                                text: '',
                                html: '<b> Hi admin!</b><br  /><br  />There were <strong>' + twoMissedClasses + '</strong> emails sent out due to missed classes today. <br/> There were <strong>' +
                                    fourMissedClasses + '</strong> removals from a course today.' // html body
                            };
                            new MailService().sendMessage("Scheduled Message", mailOptionsAdmin);
                            console.log("TOTAL WARNING EMAILS SENT: " + twoMissedClasses);
                            console.log("TOTAL REMOVAL EMAILS SENT: " + fourMissedClasses);
                        }).catch(function (err) {
                            console.log("Select courseID and courseName from all courses " + err);
                        });
                    }).catch(function (err) {
                        console.log("Select userID and email from all users " + err);
                    });
                }).catch(function (err) {
                    console.log("Select all students " + err);
                });
            }).catch(function (err) {
                console.log("Get all attendance " + err);
            });
        }).catch(function (err) {
            console.log(err);
        });
    }
    catch (err) {
        console.log(err);
    }
});

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NlcnZlci9zcmMvc2VydmljZXMvU2NoZWR1bGVTZXJ2aWNlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLElBQU0sUUFBUSxHQUFHLE9BQU8sQ0FBQyxlQUFlLENBQUMsQ0FBQztBQUMxQyxJQUFNLFdBQVcsR0FBRyxPQUFPLENBQUMsZUFBZSxDQUFDLENBQUM7QUFDN0MsSUFBSSxHQUFHLEdBQUcsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDO0FBQzNCLElBQUksTUFBTSxHQUFHLE9BQU8sQ0FBQyxXQUFXLENBQUMsQ0FBQztBQUVsQywwQkFBMEI7QUFDMUIsSUFBSSxlQUFlLEdBQUcsUUFBUSxDQUFDLFdBQVcsQ0FBQyxlQUFlLEVBQUU7SUFDNUQsSUFBSSxJQUFJLEdBQUcsSUFBSSxJQUFJLEVBQUUsQ0FBQztJQUN0QixJQUFJLGdCQUFnQixHQUFHLENBQUMsRUFBRSxpQkFBaUIsR0FBRyxDQUFDLENBQUM7SUFDaEQsSUFBSSxPQUFPLENBQUM7SUFFWixJQUFJO1FBQ0YsR0FBRyxDQUFDLE9BQU8sQ0FBQyxNQUFNLENBQUMsRUFBRSxDQUFDO2FBQ3JCLElBQUksQ0FBQyxVQUFTLFVBQVU7WUFDdkIsSUFBSSxHQUFHLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQztpQkFDMUIsS0FBSyxDQUFDLDZDQUE2QyxDQUFDO2lCQUNwRCxJQUFJLENBQUMsVUFBUyxnQkFBZ0I7Z0JBQzdCLElBQUksR0FBRyxDQUFDLE9BQU8sQ0FBQyxVQUFVLENBQUM7cUJBQzFCLEtBQUssQ0FBQyxrREFBa0QsQ0FBQztxQkFDekQsSUFBSSxDQUFDLFVBQVMsY0FBYztvQkFDM0IsSUFBSSxHQUFHLENBQUMsT0FBTyxDQUFDLFVBQVUsQ0FBQzt5QkFDMUIsS0FBSyxDQUFDLGlDQUFpQyxDQUFDO3lCQUN4QyxJQUFJLENBQUMsVUFBUyxXQUFXO3dCQUN4QixJQUFJLEdBQUcsQ0FBQyxPQUFPLENBQUMsVUFBVSxDQUFDOzZCQUMxQixLQUFLLENBQUMseUNB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QyxVQUFTLEdBQUc7d0JBQ25CLE9BQU8sQ0FBQyxHQUFHLENBQUMseUNBQXlDLEdBQUcsR0FBRyxDQUFDLENBQUM7b0JBQy9ELENBQUMsQ0FBQyxDQUFDO2dCQUNMLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxVQUFTLEdBQUc7b0JBQ25CLE9BQU8sQ0FBQyxHQUFHLENBQUMsc0JBQXNCLEdBQUcsR0FBRyxDQUFDLENBQUM7Z0JBQzVDLENBQUMsQ0FBQyxDQUFDO1lBQ0wsQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDLFVBQVMsR0FBRztnQkFDbkIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxxQkFBcUIsR0FBRyxHQUFHLENBQUMsQ0FBQztZQUMzQyxDQUFDLENBQUMsQ0FBQztRQUNMLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxVQUFTLEdBQUc7WUFDbkIsT0FBTyxDQUFDLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNuQixDQUFDLENBQUMsQ0FBQztLQUNKO0lBQ0QsT0FBTyxHQUFHLEVBQUU7UUFDVixPQUFPLENBQUMsR0FBRyxDQUFDLEdBQUcsQ0FBQyxDQUFDO0tBQ2xCO0FBRUgsQ0FBQyxDQUFDLENBQUMiLCJmaWxlIjoic2VydmljZXMvU2NoZWR1bGVTZXJ2aWNlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiY29uc3Qgc2NoZWR1bGUgPSByZXF1aXJlKCdub2RlLXNjaGVkdWxlJyk7XHJcbmNvbnN0IE1haWxTZXJ2aWNlID0gcmVxdWlyZShcIi4vTWFpbFNlcnZpY2VcIik7XHJcbnZhciBzcWwgPSByZXF1aXJlKCdtc3NxbCcpO1xyXG52YXIgY29uZmlnID0gcmVxdWlyZSgnLi4vY29uZmlnJyk7XHJcblxyXG4vL3J1bnMgZXZlcnkgbmlnaHQgYXQgMTBwbVxyXG52YXIgYXR0ZW5kYW5jZUNoZWNrID0gc2NoZWR1bGUuc2NoZWR1bGVKb2IoJzAgMzAgMTkgKiAqIConLCBmdW5jdGlvbigpIHtcclxudmFyIGRhdGUgPSBuZXcgRGF0ZSgpO1xyXG52YXIgdHdvTWlzc2VkQ2xhc3NlcyA9IDAsIGZvdXJNaXNzZWRDbGFzc2VzID0gMDtcclxudmFyIHN0dWRlbnQ7XHJcblxyXG50cnkge1xyXG4gIHNxbC5jb25uZWN0KGNvbmZpZy5kYilcclxuICAudGhlbihmdW5jdGlvbihjb25uZWN0aW9uKSB7XHJcbiAgICBuZXcgc3FsLlJlcXVlc3QoY29ubmVjdGlvbilcclxuICAgIC5xdWVyeShcIlNFTEVDVCAqIEZST00gQXR0ZW5kYW5jZSBPUkRFUiBCWSBkYXRlIERFU0NcIilcclxuICAgIC50aGVuKGZ1bmN0aW9uKGF0dGVuZGFuY2VSZXN1bHQpIHtcclxuICAgICAgbmV3IHNxbC5SZXF1ZXN0KGNvbm5lY3Rpb24pXHJcbiAgICAgIC5xdWVyeShcIlNFTEVDVCB1c2VySUQsIGZpcnN0TmFtZSwgbGFzdE5hbWUgRlJPTSBTdHVkZW50c1wiKVxyXG4gICAgICAudGhlbihmdW5jdGlvbihzdHVkZW50c1Jlc3VsdCkge1xyXG4gICAgICAgIG5ldyBzcWwuUmVxdWVzdChjb25uZWN0aW9uKVxyXG4gICAgICAgIC5xdWVyeShcIlNFTEVDVCB1c2VySUQsIGVtYWlsIEZST00gVXNlcnNcIilcclxuICAgICAgICAudGhlbihmdW5jdGlvbih1c2Vyc1Jlc3VsdCkge1xyXG4gICAgICAgICAgbmV3IHNxbC5SZXF1ZXN0KGNvbm5lY3Rpb24pXHJcbiAgICAgICAgICAucXVlcnkoXCJTRUxFQ1QgY291cnNlSUQsIGNvdXJzZU5hbWUgRlJPTSBDb3Vyc2VcIilcclxuICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKGNvdXJzZXNSZXN1bHQpIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgc3R1ZGVudCBvZiBzdHVkZW50c1Jlc3VsdCkge1xyXG4gICAgICAgICAgICAgIHZhciB1c2VySW5mbyA9IHVzZXJzUmVzdWx0LmZpbHRlcih4ID0+IHgudXNlcklEID09PSBzdHVkZW50LnVzZXJJRCk7XHJcbiAgICAgICAgICAgICAgdmFyIHN0dWRlbnRBdHRlbmRhbmNlID0gYXR0ZW5kYW5jZVJlc3VsdC5maWx0ZXIoeCA9PiB4LnVzZXJJRCA9PT0gc3R1ZGVudC51c2VySUQpO1xyXG4gICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiIyBvZiBhdHRlbmRhbmNlIHJlY29yZHMgZm9yIFwiICsgc3R1ZGVudC5maXJzdE5hbWUgKyBcIjogXCIgKyBzdHVkZW50QXR0ZW5kYW5jZS5sZW5ndGgpO1xyXG4gICAgICAgICAgICAgIGZ1bmN0aW9uIGNvdXJzZUJ5KGFycmF5LCBmKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgY291cnNlcyA9IHt9O1xyXG4gICAgICAgICAgICAgICAgYXJyYXkuZm9yRWFjaChmdW5jdGlvbihvKSB7XHJcbiAgICAgICAgICAgICAgICAgIHZhciBjb3Vyc2UgPSBKU09OLnN0cmluZ2lmeShmKG8pKTtcclxuICAgICAgICAgICAgICAgICAgY291cnNlc1tjb3Vyc2VdID0gY291cnNlc1tjb3Vyc2VdIHx8IFtdO1xyXG4gICAgICAgICAgICAgICAgICBjb3Vyc2VzW2NvdXJzZV0ucHVzaChvKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIE9iamVjdC5rZXlzKGNvdXJzZXMpLm1hcChmdW5jdGlvbihjb3Vyc2UpIHtcclxuICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvdXJzZXNbY291cnNlXTtcclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIHZhciByZXN1bHQgPSBjb3Vyc2VCeShzdHVkZW50QXR0ZW5kYW5jZSwgZnVuY3Rpb24oaXRlbSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFtpdGVtLmNvdXJzZUlELCBpdGVtLnVzZXJJRF07XHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgZm9yIChsZXQgY291cnNlIG9mIHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb3Vyc2UubGVuZ3RoIC0gMTsgaSsrKSB7XHJcbiAgICAgICAgICAgICAgICAgIHZhciBhdmFpbGFibGVDb3Vyc2VzID0gY291cnNlLmZpbHRlcih4ID0+IHguZm91ck1pc3NlZENsYXNzTXNnID09PSBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgIGlmIChhdmFpbGFibGVDb3Vyc2VzLmxlbmd0aCA+PSA0ICYmIGNvdXJzZVtpICsgMV0gIT0gbnVsbCAmJiBjb3Vyc2VbaSArIDJdICE9IG51bGwgJiYgY291cnNlW2kgKyAzXSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNvdXJzZVtpXS5mb3VyTWlzc2VkQ2xhc3NNc2cgPT09IGZhbHNlICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICBjb3Vyc2VbaSArIDFdLmZvdXJNaXNzZWRDbGFzc01zZyA9PT0gZmFsc2UgJiZcclxuICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZVtpICsgMl0uZm91ck1pc3NlZENsYXNzTXNnID09PSBmYWxzZSAmJlxyXG4gICAgICAgICAgICAgICAgICAgICAgY291cnNlW2kgKyAzXS5mb3VyTWlzc2VkQ2xhc3NNc2cgPT09IGZhbHNlICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICBjb3Vyc2VbaV0uYXR0ZW5kYW5jZVZhbHVlID09PSAnQScgJiZcclxuICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZVtpICsgMV0uYXR0ZW5kYW5jZVZhbHVlID09PSAnQScgJiZcclxuICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZVtpICsgMl0uYXR0ZW5kYW5jZVZhbHVlID09PSAnQScgJiZcclxuICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZVtpICsgM10uYXR0ZW5kYW5jZVZhbHVlID09PSAnQScpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgLy9tYXJrIGF0dGVuZGFuY2UgcmVjb3JkcyBhcyByZXZpZXdlZCBhbmQgbWVzc2FnZSBzZW50XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZVtpXS5mb3VyTWlzc2VkQ2xhc3NNc2cgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3Vyc2VbaSArIDFdLmZvdXJNaXNzZWRDbGFzc01zZyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZVtpICsgMl0uZm91ck1pc3NlZENsYXNzTXNnID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY291cnNlW2kgKyAzXS5mb3VyTWlzc2VkQ2xhc3NNc2cgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3Vyc2VbaV0udHdvTWlzc2VkQ2xhc3NNc2cgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb3Vyc2VbaSArIDFdLnR3b01pc3NlZENsYXNzTXNnID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY291cnNlW2kgKyAyXS50d29NaXNzZWRDbGFzc01zZyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZVtpICsgM10udHdvTWlzc2VkQ2xhc3NNc2cgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY291cnNlSW5mbyA9IGNvdXJzZXNSZXN1bHQuZmlsdGVyKHggPT4geC5jb3Vyc2VJRCA9PT0gY291cnNlW2ldLmNvdXJzZUlEKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJfX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRm91ciBjb25zZWN1dGl2ZSBjbGFzc2VzIG1pc3NlZCBieTogXCIgKyBzdHVkZW50LmZpcnN0TmFtZSArIFwiIFwiICsgc3R1ZGVudC5sYXN0TmFtZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiU3R1ZGVudCBJRDogXCIgKyBjb3Vyc2VbaV0udXNlcklEICsgXCIgLSBcIiArIGNvdXJzZVtpICsgMV0udXNlcklEKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJEYXRlczogXCIgKyBjb3Vyc2VbaV0uZGF0ZSArICcgJiAnICsgY291cnNlW2kgKyAxXS5kYXRlICsgJyAmICcgKyBjb3Vyc2VbaSArIDJdLmRhdGUgKyAnICYgJyArIGNvdXJzZVtpICsgM10uZGF0ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiQ291cnNlIElEOiBcIiArIGNvdXJzZVtpXS5jb3Vyc2VJRCArIFwiIC0gXCIgKyBjb3Vyc2VbaSArIDFdLmNvdXJzZUlEKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJFbWFpbDogXCIgKyB1c2VySW5mb1swXS5lbWFpbCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3VyTWlzc2VkQ2xhc3NlcyArPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgbWFpbE9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbTogY29uZmlnLm1haWwudXNlciwgLy8gc2VuZGVyIGFkZHJlc3NcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB0bzogdXNlckluZm9bMF0uZW1haWwsIC8vIGxpc3Qgb2YgcmVjZWl2ZXJzXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgc3ViamVjdDogJ1JlbW92YWwgZnJvbSAnICsgY291cnNlSW5mb1swXS5jb3Vyc2VOYW1lLCAvLyBTdWJqZWN0IGxpbmVcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB0ZXh0OiAnJywgLy8gcGxhaW4gdGV4dCBib2R5XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgaHRtbDogJ0hpICcgKyBzdHVkZW50LmZpcnN0TmFtZSArICcsPGJyIC8+PGJyIC8+T3VyIHJlY29yZHMgaW5kaWNhdGUgdGhhdCB5b3UgaGF2ZSBtaXNzZWQgNTAlIG9yIG1vcmUgb2YgeW91ciAnICsgY291cnNlSW5mb1swXS5jb3Vyc2VOYW1lICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAnIGNsYXNzZXMgaW4gdGhlIGxhc3QgZm91ciB3ZWVrcy4gT3VyIHBvbGljeSBzdGF0ZXMgdGhhdCBzdHVkZW50cyB3aWxsIGJlIHdpdGhkcmF3biB3aGVuIHRoaXMgbXVjaCB0aW1lIGhhcyBiZWVuIG1pc3NlZC4gVW5mb3J0dW5hdGVseSwgJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJ3RoaXMgbWVhbnMgdGhhdCB5b3UgYXJlIGJlaW5nIGV4aXRlZCBmcm9tICcgKyBjb3Vyc2VJbmZvWzBdLmNvdXJzZU5hbWUgKyAnIGNsYXNzLjxiciAvPjxiciAvPlBsZWFzZSBjb250YWN0IG1lIGJ5IHBob25lIGF0IDcwNS03MjgtMTk2OCwgRXh0LiBYWFhYIG9yIGJ5ICcgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICdlbWFpbCBhdCA8YT5DaGVyeWwuQm95ZXNAR2VvcmdpYW5Db2xsZWdlLmNhPC9hPiB0byBjb21wbGV0ZSB0aGUgbmVjZXNzYXJ5IHBhcGVyd29yayBhbmQgZGlzY3VzcyBwb3NzaWJsZSBvcHBvcnR1bml0aWVzIGZvciByZXR1cm5pbmcgdG8gdGhlICcgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGNvdXJzZUluZm9bMF0uY291cnNlTmFtZSArICcgY2xhc3MgYXQgYSBsYXRlciBkYXRlLjxiciAvPjxiciAvPlJlZ2FyZHMsPGJyIC8+PGJyIC8+PHN0cm9uZz5DaGVyeWwgQm95ZXM8L3N0cm9uZz48YnIgLz48c3Ryb25nPkFjYWRlbWljIFVwZ3JhZGluZyBPZmZpY2VyPC9zdHJvbmc+JyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJzxiciAvPkdlb3JnaWFuIENvbGxlZ2V8IE9uZSBHZW9yZ2lhbiBEcml2ZSB8IEJhcnJpZSBPTiB8IEw0TSAzWDknIC8vIGh0bWwgYm9keVxyXG4gICAgICAgICAgICAgICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcXVlcnkgPSBcIlVQREFURSBBdHRlbmRhbmNlIFNFVCBmb3VyTWlzc2VkQ2xhc3NNc2cgPSAndHJ1ZScsIHR3b01pc3NlZENsYXNzTXNnID0gJ3RydWUnIFdIRVJFIGF0dGVuZGFuY2VJRCBJTlwiICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgXCIgKCdcIiArIGNvdXJzZVtpXS5hdHRlbmRhbmNlSUQgKyBcIicsJ1wiICsgY291cnNlW2kgKyAxXS5hdHRlbmRhbmNlSUQgKyBcIicsJ1wiICsgY291cnNlW2kgKyAyXS5hdHRlbmRhbmNlSUQgKyBcIicsJ1wiICsgY291cnNlW2kgKyAzXS5hdHRlbmRhbmNlSUQgKyBcIicpXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBzcWwuUmVxdWVzdChjb25uZWN0aW9uKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAucXVlcnkocXVlcnkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBNYWlsU2VydmljZSgpLnNlbmRNZXNzYWdlKCdGb3VyIE1pc3NlZCBDbGFzc2VzJywgbWFpbE9wdGlvbnMpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlVwZGF0ZSBhdHRlbmRhbmNlIHJlY29yZHM6IFwiICsgZXJyKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChjb3Vyc2UubGVuZ3RoID49IDIgJiYgY291cnNlW2kgKyAxXSAhPSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICBpZiAoY291cnNlW2ldLmF0dGVuZGFuY2VWYWx1ZSA9PT0gJ0EnICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICBjb3Vyc2VbaSArIDFdLmF0dGVuZGFuY2VWYWx1ZSA9PT0gJ0EnICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICBjb3Vyc2VbaV0udHdvTWlzc2VkQ2xhc3NNc2cgPT09IGZhbHNlICYmXHJcbiAgICAgICAgICAgICAgICAgICAgICBjb3Vyc2VbaSArIDFdLnR3b01pc3NlZENsYXNzTXNnID09PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvL21hcmsgYXR0ZW5kYW5jZSByZWNvcmRzIGFzIHJldmlld2VkIGFuZCBtZXNzYWdlIHNlbnRcclxuICAgICAgICAgICAgICAgICAgICAgICAgY291cnNlW2ldLnR3b01pc3NlZENsYXNzTXNnID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY291cnNlW2kgKyAxXS50d29NaXNzZWRDbGFzc01zZyA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBjb3Vyc2VJbmZvID0gY291cnNlc1Jlc3VsdC5maWx0ZXIoeCA9PiB4LmNvdXJzZUlEID09PSBjb3Vyc2VbaV0uY291cnNlSUQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX1wiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJUd28gY29uc2VjdXRpdmUgY2xhc3NlcyBoYXZlIGJlZW4gbWlzc2VkIGJ5OiBcIiArIHN0dWRlbnQuZmlyc3ROYW1lICsgXCIgXCIgKyBzdHVkZW50Lmxhc3ROYW1lKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJTdHVkZW50IElEOiBcIiArIGNvdXJzZVtpXS51c2VySUQgKyBcIiAtIFwiICsgY291cnNlW2kgKyAxXS51c2VySUQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkRhdGVzOiBcIiArIGNvdXJzZVtpXS5kYXRlICsgJyAmICcgKyBjb3Vyc2VbaSArIDFdLmRhdGUpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIkNvdXJzZSBJRDogXCIgKyBjb3Vyc2VbaV0uY291cnNlSUQgKyBcIiAtIFwiICsgY291cnNlW2kgKyAxXS5jb3Vyc2VJRCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiRW1haWw6IFwiICsgdXNlckluZm9bMF0uZW1haWwpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIl9fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX19fX1wiKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdHdvTWlzc2VkQ2xhc3NlcyArPSAxO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgbWFpbE9wdGlvbnMgPSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgZnJvbTogY29uZmlnLm1haWwudXNlciwgLy8gc2VuZGVyIGFkZHJlc3NcclxuICAgICAgICAgICAgICAgICAgICAgICAgICB0bzogdXNlckluZm9bMF0uZW1haWwsIC8vIHN0dWRlbnQuZW1haWxcclxuICAgICAgICAgICAgICAgICAgICAgICAgICBzdWJqZWN0OiAnVHdvIE1pc3NlZCAnICsgY291cnNlSW5mb1swXS5jb3Vyc2VOYW1lICsgJyBDbGFzc2VzJywgLy8gU3ViamVjdCBsaW5lXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogJycsIC8vIHBsYWluIHRleHQgYm9keVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgIGh0bWw6ICdIaSAnICsgc3R1ZGVudC5maXJzdE5hbWUgKyAnLDxiciAvPjxiciAvPkkgbm90aWNlZCB0aGF0IHlvdSBtaXNzZWQgdGhlIGxhc3QgdHdvIGNvbnNlY3V0aXZlICcgKyBjb3Vyc2VJbmZvWzBdLmNvdXJzZU5hbWUgKyAnIGNsYXNzZXMuJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJyBJIGhvcGUgZXZlcnl0aGluZyBpcyBva2F5LiBMZXQgbWUga25vdyBpZiB0aGVyZSBpcyBzb21ldGhpbmcgSSBjYW4gZG8gdG8gaGVscC48YnIgLz48YnIgLz5QbGVhc2UgYmUgcmVtaW5kZWQgb2Ygb3VyIHByb2dyYW0gJyArXHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgJ3BvbGljeSB0aGF0IHN0YXRlcyBzdHVkZW50cyBhcmUgcmVzcG9uc2libGUgdG8gbm90aWZ5IHRoZWlyIGluc3RydWN0b3JzIHdoZW4gdGhleSB3aWxsIGJlIGFic2VudC4gSW4gYWRkaXRpb24sIHRoZSBwb2xpY3kgZGlyZWN0cyAnICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAnc3R1ZGVudHMgdG8gYXJyYW5nZSBmb3IgYSBsZWF2ZSBvZiBhYnNlbmNlIGlmIHRoZXkgbmVlZCB0byBtaXNzIHR3byBvciBtb3JlIGNsYXNzZXMgaW4gYSByb3cuIEEgbGVhdmUgb2YgYWJzZW5jZSBjYW4gYmUgYXJyYW5nZWQgd2l0aCAnICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAnQ2hlcnlsIEJveWVzLCB3aG8gY2FuIGNvbnRhY3RlZCBieSBwaG9uZSBhdCA3MDUtNzI4LTE5NjgsIEV4dC4gWFhYWCBvciBieSBlbWFpbCBhdCA8YT5DaGVyeWwuQm95ZXNAR2VvcmdpYW5Db2xsZWdlLmNhPC9hPjxiciAvPjxiciAvPlBsZWFzZSAnICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAnZ2V0IGluIHRvdWNoIHdpdGggbWUgYXMgc29vbiBhcyBwb3NzaWJsZS4gVW5mb3J0dW5hdGVseSwgaWYgSSBkb27igJl0IGhlYXIgZnJvbSB5b3UsIGFuZCB5b3UgbWlzcyB0aGUgbmV4dCB0d28gY2xhc3NlcywgeW91IHJpc2sgYmVpbmcgd2l0aGRyYXduICcgK1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICdmcm9tICcgKyBjb3Vyc2VJbmZvWzBdLmNvdXJzZU5hbWUgKyAnLjxiciAvPjxiciAvPkJlc3QgUmVnYXJkcyw8YnIgLz48YnIgLz48c3Ryb25nPkpvYW5uZSBQaW5lZGEsIE1BIEFkRWQ8L3N0cm9uZz48YnIgLz48c3Ryb25nPkFjYWRlbWljIFByZXBhcmF0aW9uIEZhY3VsdHknICtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAnPC9zdHJvbmc+PGJyIC8+PGJyIC8+R2VvcmdpYW4gQ29sbGVnZXwgT25lIEdlb3JnaWFuIERyaXZlIHwgQmFycmllIE9OIHwgTDRNIDNYOScgLy8gaHRtbCBib2R5XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBxdWVyeSA9IFwiVVBEQVRFIEF0dGVuZGFuY2UgU0VUIHR3b01pc3NlZENsYXNzTXNnID0gJ3RydWUnIFdIRVJFIGF0dGVuZGFuY2VJRCBJTiAoJ1wiICsgY291cnNlW2ldLmF0dGVuZGFuY2VJRCArIFwiJywnXCIgKyBjb3Vyc2VbaSArIDFdLmF0dGVuZGFuY2VJRCArIFwiJylcIjtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IHNxbC5SZXF1ZXN0KGNvbm5lY3Rpb24pXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5xdWVyeShxdWVyeSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24ocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IE1haWxTZXJ2aWNlKCkuc2VuZE1lc3NhZ2UoJ1R3byBNaXNzZWQgQ2xhc3NlcycsIG1haWxPcHRpb25zKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJTZWxlY3QgdXNlcklEIGFuZCBlbWFpbCBmcm9tIGFsbCB1c2VycyBcIiArIGVycik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICBsZXQgbWFpbE9wdGlvbnNBZG1pbiA9IHtcclxuICAgICAgICAgICAgICAgIGZyb206ICdhY2FkZW1pYy5jYXJlZXIucHJlcEBnbWFpbC5jb20nLCAvLyBzZW5kZXIgYWRkcmVzc1xyXG4gICAgICAgICAgICAgICAgdG86ICdhY2FkZW1pYy5jYXJlZXIucHJlcEBnbWFpbC5jb20nLCAvLyBsaXN0IG9mIHJlY2VpdmVyc1xyXG4gICAgICAgICAgICAgICAgc3ViamVjdDogJ1NDSEVEVUxFUiDinJQnLCAvLyBTdWJqZWN0IGxpbmVcclxuICAgICAgICAgICAgICAgIHRleHQ6ICcnLCAvLyBwbGFpbiB0ZXh0IGJvZHlcclxuICAgICAgICAgICAgICAgIGh0bWw6ICc8Yj4gSGkgYWRtaW4hPC9iPjxiciAgLz48YnIgIC8+VGhlcmUgd2VyZSA8c3Ryb25nPicgKyB0d29NaXNzZWRDbGFzc2VzICsgJzwvc3Ryb25nPiBlbWFpbHMgc2VudCBvdXQgZHVlIHRvIG1pc3NlZCBjbGFzc2VzIHRvZGF5LiA8YnIvPiBUaGVyZSB3ZXJlIDxzdHJvbmc+JyArXHJcbiAgICAgICAgICAgICAgICBmb3VyTWlzc2VkQ2xhc3NlcyArICc8L3N0cm9uZz4gcmVtb3ZhbHMgZnJvbSBhIGNvdXJzZSB0b2RheS4nIC8vIGh0bWwgYm9keVxyXG4gICAgICAgICAgICAgIH07XHJcbiAgICAgICAgICAgICAgbmV3IE1haWxTZXJ2aWNlKCkuc2VuZE1lc3NhZ2UoXCJTY2hlZHVsZWQgTWVzc2FnZVwiLCBtYWlsT3B0aW9uc0FkbWluKTtcclxuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlRPVEFMIFdBUk5JTkcgRU1BSUxTIFNFTlQ6IFwiICsgdHdvTWlzc2VkQ2xhc3Nlcyk7XHJcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJUT1RBTCBSRU1PVkFMIEVNQUlMUyBTRU5UOiBcIiArIGZvdXJNaXNzZWRDbGFzc2VzKTtcclxuICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJTZWxlY3QgY291cnNlSUQgYW5kIGNvdXJzZU5hbWUgZnJvbSBhbGwgY291cnNlcyBcIiArIGVycik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiU2VsZWN0IHVzZXJJRCBhbmQgZW1haWwgZnJvbSBhbGwgdXNlcnMgXCIgKyBlcnIpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgICAgICBjb25zb2xlLmxvZyhcIlNlbGVjdCBhbGwgc3R1ZGVudHMgXCIgKyBlcnIpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICB9KS5jYXRjaChmdW5jdGlvbihlcnIpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcIkdldCBhbGwgYXR0ZW5kYW5jZSBcIiArIGVycik7XHJcbiAgICAgIH0pO1xyXG4gICAgfSkuY2F0Y2goZnVuY3Rpb24oZXJyKSB7XHJcbiAgICAgIGNvbnNvbGUubG9nKGVycik7XHJcbiAgICB9KTtcclxuICB9XHJcbiAgY2F0Y2ggKGVycikge1xyXG4gICAgY29uc29sZS5sb2coZXJyKTtcclxuICB9XHJcblxyXG59KTtcclxuIl19
